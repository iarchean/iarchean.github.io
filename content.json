{"pages":[{"title":"Archean Zhang","text":"System Engineer @ TokyoEmail: zephyr422 @ gmail.com","link":"/about/index.html"}],"posts":[{"title":"è‹¹æœ iCloud Keychain è‡ªå¸¦çš„åŒé‡è®¤è¯å™¨å¥½ç”¨å—ï¼Ÿ","text":"é¦–å…ˆï¼ŒåŒé‡è®¤è¯ï¼ˆTwo-Factor Authentication or 2FAï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ åŒé‡è®¤è¯ï¼ˆ2FAï¼‰æ˜¯ä¸€ä¸ªå®‰å…¨è¿‡ç¨‹ï¼Œç”¨æˆ·å¿…é¡»æä¾›ä¸¤ç§ä¸åŒçš„èº«ä»½éªŒè¯å› ç´ æ¥éªŒè¯å…¶èº«ä»½å¹¶è®¿é—®å…¶å¸æˆ·ã€‚æ­¤è¿‡ç¨‹ç¡®ä¿æ›´å¥½åœ°ä¿æŠ¤ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯ã€å‡­æ®å’Œå…¶ä»–èµ„äº§ï¼ŒåŒæ—¶æé«˜ç”¨æˆ·å¯ä»¥è®¿é—®çš„èµ„æºçš„å®‰å…¨æ€§ã€‚(Source: What is 2FA?) ç®€å•æ¥è¯´ï¼ŒåŒé‡è®¤è¯ï¼Œå³ã€Œä½ æ˜¯è°ã€ä½ æœ‰ä»€ä¹ˆã€ä½ çŸ¥é“ä»€ä¹ˆã€ä¸‰è€…ä¸­çš„ä¸¤ä¸ªã€‚ æˆ‘æ˜¯ä¸€ä¸ªå°ç™½/æˆ‘çš„è´¦å·ä¸é‚£ä¹ˆé‡è¦/è°ä¼šæ¥æ”»å‡»æˆ‘å•Šï¼Œæœ‰å¿…è¦ä½¿ç”¨åŒé‡è®¤è¯å—ï¼Ÿ æˆ‘çš„è§‚ç‚¹ï¼šä»»ä½•äººéƒ½æœ‰å¿…è¦ä½¿ç”¨åŒé‡è®¤è¯ã€‚ å®‰å…¨æ˜¯æ°¸æ’çš„è¯é¢˜ï¼Œç‰¹åˆ«æ˜¯ä½ å½“ä»Šçš„ç”Ÿæ´»æ¶ˆè´¹å¨±ä¹æ¶ˆé£éƒ½åœ¨äº’è”ç½‘ä¸Šè¿›è¡Œï¼Œè€Œä½ ç”¨äº†ç”Ÿæ—¥/å¥³å‹ç”Ÿæ—¥/é—¨ç‰Œå·/åå­—æ‹¼éŸ³å½“ä½œå¯†ç æ—¶ï¼Œ2FA å°±æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚è€Œ 2FA å®é™…ä¸Šæ˜¯æ— æ‰€ä¸åœ¨çš„ï¼šå½“ä½ ç™»å½•å¾®ä¿¡æ—¶ï¼Œä¼šåˆ¤è¯»æ˜¯å¦æ˜¯å¸¸ç”¨è®¾å¤‡ï¼›å½“ä½ ç™»å½•æ·˜å®æ—¶ï¼Œä¼šè¦çŸ­ä¿¡éªŒè¯ç ï¼›å½“ä½ ç™»å½•é“¶è¡Œ App æ—¶ï¼Œä¼šè¦æ‰«è„¸ï¼›å½“ä½ ç™»å½• AppleID æ—¶ï¼Œè¦ç”¨å¦ä¸€å°è‹¹æœè®¾å¤‡ç¡®è®¤ã€‚é‚£ä¹ˆä½ çš„å¸¸ç”¨è®¾å¤‡ã€ä½ çš„æ‰‹æœºå·ã€ä½ çš„è„¸ã€ä½ çš„å¦ä¸€å°æ‰‹æœºï¼Œå°±æ˜¯ç¬¬äºŒé‡èº«ä»½è®¤è¯å…ƒç´ ï¼šä¸€ä¸ªæ”»å‡»è€…ä¸æ˜“è·å¾—çš„ã€Œä¸œè¥¿ã€ã€‚ æ—¢ç„¶ App å·²ç»æœ‰äº† 2FAï¼Œé‚£æˆ‘ä¸ºä»€ä¹ˆè¿˜è¦ä½¿ç”¨åŒé‡è®¤è¯å™¨ï¼Ÿ åŒé‡è®¤è¯å™¨ä¸ºä¸€äº›ä¸å®¹æ˜“é‡‡ç”¨ç”Ÿç‰©ä¿¡æ¯ã€è®¾å¤‡ç»‘å®šï¼Œæˆ–è€…æ²¡æœ‰è®°å½•æ‰‹æœºå·çš„è‰¯å¿ƒåº”ç”¨ï¼ˆä¸å¸¸å‡ºç°åœ¨ç®€ä½“ä¸­æ–‡äº’è”ç½‘ç¯å¢ƒä¸­ï¼‰ï¼Œæä¾›äº†ä¸€ä¸ªæ¯”è¾ƒé€šç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œå› æ­¤åœ¨ä¸€äº›é¢å‘æ¶ˆè´¹è€…çš„ Web åº”ç”¨ä¸­å¹¿æ³›é‡‡ç”¨ã€‚ è¯´å›è‹¹æœiOS 15 æœ€ä»¤æˆ‘æœŸå¾…çš„åŠŸèƒ½ä¹‹ä¸€ï¼Œä¾¿æ˜¯è‹¹æœè‡ªå®¶çš„åŒé‡è®¤è¯å™¨ï¼Œå®ƒæ²¡æœ‰å•ç‹¬çš„åº”ç”¨ï¼Œæ˜¯é›†æˆåœ¨ Keychain ä¸­çš„ï¼›ä¼¼ä¹ä¹Ÿæ²¡æœ‰å®˜æ–¹å‘½åï¼Œæˆ‘å§‘ä¸”ç§°å…¶ä¸º iCloud Keychain 2FAã€‚2FA åº”ç”¨æœ‰å¾ˆå¤šï¼ŒGoogleã€Microsoftã€Twilio ç­‰å¤§å‚éƒ½æ¨å‡ºäº†è‡ªå·±çš„åº”ç”¨ï¼Œå…¶å®ä¸€å‘æ³¨é‡å®‰å…¨çš„è‹¹æœåŠ¨ä½œè¿™ä¹ˆæ…¢è¿˜è›®ç½•è§çš„ï¼Œè€Œä¸”åº”ç”¨ç›®å‰ä»ç„¶æ¯”è¾ƒåˆçº§ã€‚ iCloud Keychain 2FA ä¹Ÿæ˜¯åŸºäºæ—¶é—´çš„ä¸€æ¬¡æ€§å¯†ç  (TOTP) åº”ç”¨ç¨‹åºï¼Œä¸å…¶ä»–çš„ 2FA åº”ç”¨å·®ä¸å¤šï¼šä½¿ç”¨ç§»åŠ¨è®¾å¤‡çš„åº”ç”¨ç¨‹åºæ‰«æ QR ç æˆ–æ‰‹åŠ¨è¾“å…¥ Setup Keyï¼Œä¹‹ååº”ç”¨ç¨‹åºä¼šæ˜¾ç¤ºå…­ä½æ•°ä»£ç ï¼Œå°†å…¶å¡«å…¥ç½‘ç«™å³å¯å®Œæˆç»‘å®šã€‚åŒæ—¶ç½‘ç«™ä¼šæä¾›ä¸€ç³»åˆ—æ¢å¤ç ï¼ˆrecovery codesï¼‰ï¼Œä»¥ä¾¿åœ¨ 2FA åº”ç”¨æ— æ³•ä½¿ç”¨æ—¶ï¼Œæ¶ˆè€—ä¸€æšæ¢å¤ç ï¼Œä¸€æ¬¡æ€§çš„è®¿é—®è´¦æˆ·ï¼Œå½“ç„¶ï¼Œè¿™æ˜¯ç½‘ç«™æä¾›çš„åŠŸèƒ½ï¼Œå°±ä¸è®¤è¯å™¨æœ¬èº«æ— å…³äº†ã€‚ iCloud Keychain 2FA ä¸ç³»ç»Ÿçš„æ·±åº¦é›†æˆæ˜¯æˆ‘æœŸå¾…å®ƒçš„ä¸»è¦åŸå› ï¼Œå¦å¤–å…¶ä»–çš„è®¤è¯å™¨åœ¨æ¢æ‰‹æœºæ—¶æ€»æœ‰å„ç§å„æ ·çš„é—®é¢˜ï¼Œè®©æˆ‘ä¸å¾—ä¸è€ƒè™‘ä½¿ç”¨æ“ä½œç³»ç»ŸåŸç”Ÿã€åŸºäº iCloud åŒæ­¥çš„è§£å†³æ–¹æ¡ˆã€‚ é‚£ä¹ˆï¼ŒåŸç”Ÿçš„ä½¿ç”¨ä½“éªŒå¦‚ä½•ï¼Ÿå…ˆçœ‹è®¾å®šï¼ˆè¿‡ç¨‹ä¸å†èµ˜è¿°ï¼ŒGitHub è¿™ç¯‡æ–‡ç« å†™çš„è¶³å¤Ÿè¯¦ç»†äº†ã€‚ï¼‰ ä¸å…¶ä»– TOTP 2FA åº”ç”¨ä¸€æ ·ï¼Œåœ¨ç½‘ç«™å¼€å¯ 2FAï¼Œé€‰æ‹© Authentication App æ—¶ï¼ŒiCloud Keychain 2FA ä¹Ÿéœ€è¦æ‰«ç ã€‚è¿™ä¸ªè¿‡ç¨‹é€šè¿‡è‡ªå¸¦ç›¸æœº App å®Œæˆï¼Œæ‰«ç åé€‰æ‹©ç›¸åº”çš„å·²ç»è®°ä½çš„è´¦å·å³å¯ã€‚ ä¸å…¶ä»– App ç•¥æœ‰å·®åˆ«ï¼ŒiCloud Keychain 2FA åœ¨ç»‘å®šæ—¶æ­¥éª¤ç¨å°‘ï¼Œå¾—ç›Šäº iOS çš„è·¨å¹³å°å…ˆå¤©ä¼˜åŠ¿ï¼Œæ— è®ºæ˜¯è®¾å®šè¿˜æ˜¯ç™»å½•è¿‡ç¨‹ä¸­ï¼Œå¡«å…¥éªŒè¯ç æ—¶ï¼Œå‡å¯ä»¥è‡ªåŠ¨å®Œæˆï¼Œä½“éªŒéå¸¸æ£’ã€‚ è‡³æ­¤è®¾å®šå®Œæˆï¼Œåˆ«å¿˜äº†ä¿å­˜å¥½è‡ªå·±çš„ Recover Codeã€‚ ç™»å½•æ—¶ï¼Œä½“éªŒä¾ç„¶æå¥½ æ— è®ºæ˜¯ç”µè„‘è¿˜æ˜¯æ‰‹æœºä¸Šçš„ Safariï¼Œè¾“å®Œè´¦å·å¯†ç åï¼Œå‡å¯è‡ªåŠ¨å¡«å…¥éªŒè¯ç ï¼Œä»¥è‡³äºï¼Œåœ¨æ­¤ç« èŠ‚ä¸­æˆ‘å®åœ¨æ²¡ä»€ä¹ˆå¯ä»¥è¯´çš„ã€‚ iOS åŸç”Ÿ App æˆ‘ä»…ä»…åœ¨æœ‰é™çš„å‡ ä¸ª App ä¸­æµ‹è¯•äº† iCloud Keychain 2FAï¼Œæ¯•ç«Ÿè¿™é‡Œä¸æ˜¯åŒé‡è®¤è¯å™¨çš„ä¸»è¦æˆ˜åœºã€‚ä½†å¦‚æœä½ çš„ App æƒ³è¦æ¥å…¥ï¼Œåº”ç”¨ä¸­å¯ä»¥ç›´æ¥è°ƒèµ· iCloud Keychain 2FAï¼Œçœç•¥æ‰«ç æˆ–è€…æ‰‹åŠ¨è¾“å…¥ Setup Key çš„è¿‡ç¨‹ï¼Œä½“éªŒæ¯”æµè§ˆå™¨ä¸­è¿˜è¦å¥½å¾ˆå¤šã€‚ é Apple å¹³å°ä¸Šï¼Œåˆä¼šæ€æ ·ä¸€ç•ªå…‰æ™¯å‘¢äº‹å®ä¸Šï¼Œå°±ç®—æ˜¯ Apple å¹³å°ä¸Šï¼Œé Safari æµè§ˆå™¨çš„æ”¯æŒä¹Ÿæ˜¯éå¸¸æœ‰é™ï¼ŒåŸºæœ¬æ²¡æœ‰åŠæ³•è‡ªåŠ¨å¡«å……ã€‚è€Œ Apple æŠŠè¿™ä¸ªåŠŸèƒ½éšè—å¾—éå¸¸æ·±ï¼Œä»¥è‡³äºæ‰‹åŠ¨å¡«å……éªŒè¯ç çš„æ—¶å€™ï¼Œè¦å¤§è´¹ä¸€ç•ªå‘¨æŠ˜ã€‚åªèƒ½è¯´æ— è®ºæ˜¯ iOSã€iPadOS è¿˜æ˜¯ macOSï¼Œæ­¤åŠŸèƒ½éƒ½å¯ä»¥å·¥ä½œï¼Œä»…æ­¤è€Œå·²ã€‚ é¦–å…ˆæ˜¯ iOS å’Œ iPadOS éœ€è¦ä¾æ¬¡è¿›å…¥ Settings â†’ Passwords (FaceID è®¤è¯)â†’ æœç´¢ç”¨æˆ·å â†’ ç‚¹å‡»å¯¹åº”ç½‘ç«™ï¼ˆå¦‚æœä¸åŒç½‘ç«™ä½¿ç”¨çš„ç›¸åŒç”¨æˆ·åï¼‰â†’ ç‚¹å‡» VERIFICATION CODE â†’ Copy Verification Code â†’ ç²˜è´´åˆ°å¯¹åº”è¾“å…¥æ¡† å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥æŠ„è¿‡å»ï¼Œçœç•¥åä¸‰æ­¥ã€‚ macOS ä¸Šä¹Ÿå¥½ä¸äº†å“ªå» è€Œæ›´è¿‡åˆ†çš„æ˜¯ï¼Œå…¥å£åœ¨ Safari è®¾ç½®ä¸­ï¼Œå¹¶ä¸åœ¨ Keychain åº”ç”¨é‡Œã€‚ æ‰“å¼€ Safari â†’ Preferences â†’ Passwords (è¾“å…¥å¯†ç ï¼) â†’ æœç´¢ç”¨æˆ·å â†’ ç‚¹å‡»å¯¹åº”ç½‘ç«™ï¼ˆå¦‚æœä¸åŒç½‘ç«™ä½¿ç”¨çš„ç›¸åŒç”¨æˆ·åï¼‰â†’ ç‚¹å‡» VERIFICATION CODE â†’ Copy Verification Code â†’ ç²˜è´´åˆ°å¯¹åº”è¾“å…¥æ¡† åŒæ ·çš„ï¼Œä¹Ÿå¯ä»¥çœç•¥åä¸‰æ­¥ã€‚ å¯¹æ¯”å…¶ä»–çš„åŒé‡è®¤è¯å™¨ï¼ŒiCloud Keychain 2FA åœ¨ç¬¬ä¸‰æ–¹æµè§ˆå™¨ä¸Šå¤åˆ¶éªŒè¯ç çš„æ“ä½œä¹‹ç¹çå¯è°“åŒªå¤·æ‰€æ€ï¼Œä¹Ÿè®¸è‹¹æœçš„å·¥ç¨‹å¸ˆæ ¹æœ¬æ²¡æœ‰æŒ‡æœ›ä½ åœ¨éè‹¹æœç”Ÿæ€ä¸‹ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ï¼Œè¯´å®åœ¨çš„ï¼Œåƒæˆ‘è¿™ç§å¶å°”ç©ç©æ¸¸æˆçš„ç”¨æˆ·ï¼ŒåŸºæœ¬æ²¡æœ‰åœ¨ Windows ä¸Šç™»å½•è´¦å·çš„æƒ³æ³•äº†ã€‚ ç»“è®ºå°±æ˜¾è€Œæ˜“è§äº†ä¼˜ç‚¹ï¼šåœ¨åŸç”Ÿ App å’Œæ”¯æŒçš„æµè§ˆå™¨ä¸­ï¼ŒiCloud Keychain 2FA å·¥ä½œçš„å¼‚å¸¸æµç•…ï¼Œä½“éªŒæå…¶ä¸æ»‘ï¼Œèƒœè¿‡ç›®å‰å¸‚é¢ä¸Šå­˜åœ¨çš„æ‰€æœ‰ 2FA åº”ç”¨ã€‚ ç¼ºç‚¹ï¼šä¸ç›´è§‚æ˜¯ iCloud Keychain 2FA çš„æœ€å¤§é—®é¢˜ã€‚ä¹Ÿè®¸è‹¹æœä¸è®¤ä¸º 2FA å€¼å¾—ä¸€ä¸ªå•ç‹¬çš„ Appï¼Œæˆ–è€…æœ‰ä¸ªå•ç‹¬çš„è®¾å®šå…¥å£ï¼Œå°±åƒä¹”å¸ƒæ–¯å½“å¹´è¯´ Dropbox ä¸åº”è¯¥æ˜¯åº”ç”¨ï¼Œè€Œåªåº”è¯¥æ˜¯åŠŸèƒ½è€Œå·²ã€‚ å¦‚æœä½ æ˜¯è‹¹æœå…¨å®¶æ¡¶ç”¨æˆ·ï¼Œå®Œå…¨å¯ä»¥å°†æ‰€æœ‰çš„ 2FA è¿ç§»è‡³ iCloud Keychainï¼Œäº«å—è‹¹æœç”Ÿæ€å¸¦æ¥çš„æè‡´ä½“éªŒï¼›ä½†å¦‚æœä½ æœ‰ä»»ä½•éè‹¹æœè®¾å¤‡ï¼Œåœ¨å…¶ä¸Šä½ è¦å¿å—è‹¹æœäº§å“è®¾è®¡ä¸­æ— å¤„ä¸åœ¨çš„å‚²æ…¢ã€‚ References Two Factor Auth | BrainStationÂ® Configuring two-factor authentication - GitHub Docs æ‰€æœ‰æ“ä½œå‡åœ¨ iOS 15.0ï¼ŒiPadOS 15.0ï¼ŒmacOS 12.0 å®Œæˆ æˆ‘å·²ç»å®Œå…¨è¿ç§»è‡³ iCloud Keychain 2FA","link":"/2021/12/06/Is-the-2FA-comes-with-Apple-iCloud-Keychain-easy-to-use/"},{"title":"F5 å¯ç”¨æ€§ç ”ç©¶ä»¥åŠä½¿ç”¨ Zabbix ç›‘æ§ F5","text":"ç›®å‰éƒ¨é—¨çš„å„ç±»ç³»ç»Ÿå¤§éƒ¨åˆ†éƒ½ä½¿ç”¨ F5 å‘å¸ƒ VIP æä¾›ç»™ç”¨æˆ·ä½¿ç”¨ï¼Œè€Œä¹‹å‰å¯¹ F5 çš„ç›‘æ§åŸºæœ¬æ²¡æœ‰ï¼Œæœ¬æ–‡è¯£åœ¨ç ”ç©¶å¦‚ä½•é€šè¿‡ SNMP çš„æ–¹å¼è¯»å– F5 çš„å„ç±»çŠ¶æ€ã€æ€§èƒ½æŒ‡æ ‡ï¼Œä»¥åŠä»€ä¹ˆæ ·çš„çŠ¶å†µéœ€è¦å»å‘Šè­¦ã€‚ å°† F5 çš„ OID æ¨¡ç‰ˆå¯¼å…¥åˆ° Zabbix Server çš„ /usr/share/snmp/mibs ç›®å½•ä¸­ä¹‹åï¼Œå³å¯ä½¿ç”¨ snmpwalk å‘½ä»¤è¯·æ±‚ F5 çš„å„é¡¹çŠ¶æ€ã€‚åœ¨è¯·æ±‚æ—¶ï¼Œå¤§éƒ¨åˆ†å€¼å‡éœ€è¦å¢åŠ  OID å‰ç¼€ï¼Œæœ¬æ–‡åŸºæœ¬åªæ¶‰åŠ F5-BIGIP-LOCAL-MIB.txt è¿™ä¸ªæ¨¡ç‰ˆä¸­çš„å†…å®¹ï¼Œæ‰€ä»¥è¯·æ±‚å‘½ä»¤çš„æ ·å­å¦‚ä¸‹ï¼š 1snmpwalk -v2c -c public F5.hostname.or.IP F5-BIGIP-LOCAL-MIB::ltmPoolMemberMonitorStatus F5 StatusF5 è‡ªèº«çŠ¶æ€ä¸­éœ€è¦å…³æ³¨çš„ä¸€ä¸ªæ˜¯ CPUã€å†…å­˜ä½¿ç”¨ç‡ï¼Œå¦å¤–å°±æ˜¯ä¸»å¤‡åŒæ­¥çŠ¶æ€åŠæ•…éšœè½¬ç§»çŠ¶æ€ã€‚ Failover Statuså¾…è¡¥å…… ConfigSync Statuså¾…è¡¥å…… Virtual ServerVirtual Serverï¼ˆVSï¼‰æ˜¯ F5 å¯¹å¤–æä¾›è®¿é—®çš„å…¥å£ï¼Œæ˜¯ Local Traffic Managerï¼ˆLTMï¼‰ä¸­æœ€å¤–å±‚çš„å¯¹è±¡ï¼Œä¸€æ—¦ Down æ‰äº†æ•´ä½“æœåŠ¡å°†ä¸å¯ç”¨ã€‚è¿™ä¹Ÿæ˜¯é™¤ F5 æœ¬èº«æŒ‚æ‰ä»¥å¤–æœ€ä¸¥é‡çš„é—®é¢˜ã€‚ VS StatusVS çŠ¶æ€å¯¹åº”çš„ä¸€ä¸ª OID å€¼æ˜¯ ltmVsStatusAvailStateï¼Œè¿™ä»£è¡¨äº† VS å¯ç”¨çŠ¶æ€ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜éœ€è¦å…³æ³¨ VS çš„è¿è¥çŠ¶æ€ï¼Œå…¶ OID å€¼æ˜¯ ltmVsStatusEnabledStateã€‚ ICON å¯ç”¨çŠ¶æ€ è¿è¥çŠ¶æ€ å¯ç”¨çŠ¶æ€ä»£ç  è¿è¥çŠ¶æ€ä»£ç  æè¿° Avaliable Enabled GREENï¼ˆ0ï¼‰ ENABLED(1) VS å·²å¯ç”¨ä¸”æ± æˆå‘˜å¥åº·æ£€æŸ¥æ­£å¸¸ Unknown Enabled BLUEï¼ˆ4ï¼‰ ENABLED(1) VS å·²å¯ç”¨ä½†æ²¡æœ‰æˆå‘˜ Offline Enabled REDï¼ˆ3ï¼‰ ENABLED(1) VS å·²å¯ç”¨ä½†æ± æˆå‘˜å¥åº·æ£€æŸ¥å¼‚å¸¸ Avaliable Disabled GREENï¼ˆ0ï¼‰ DISABLED(2) VS å·²ç¦ç”¨ä¸”æ± æˆå‘˜å¥åº·æ£€æŸ¥æ­£å¸¸ Unknown Disabled BLUEï¼ˆ4ï¼‰ DISABLED(2) VS å·²ç¦ç”¨ä½†æ²¡æœ‰æˆå‘˜ Offline Disabled REDï¼ˆ3ï¼‰ DISABLED(2) VS å·²ç¦ç”¨ä¸”æ± æˆå‘˜å¥åº·æ£€æŸ¥å¼‚å¸¸ RED(3) çŠ¶æ€åº”è¯¥æ˜¯æˆ‘ä»¬æœ€éœ€è¦å…³æ³¨çš„çŠ¶å†µã€‚å¦‚æœè¿è¥çŠ¶æ€ä¸º Enabled ä¸”å¯ç”¨çŠ¶æ€æ˜¯ Offlineï¼Œå³ä»£è¡¨æ­¤ VS å‡ºç°äº†ä¸å¯ç”¨çš„çŠ¶å†µã€‚ VS StatisticsVS Statistics ä¸­æ¯”è¾ƒéœ€è¦å…³æ³¨çš„åŒ…æ‹¬æµé‡ã€è¿æ¥æ•°ã€è¯·æ±‚æ¬¡æ•°ã€‚åˆ†åˆ«å¯¹åº”ä¸‹é¢å‡ ä¸ª OID å€¼ï¼š ltmVirtualServStatClientCurConns ltmVirtualServStatTotRequests ltmVirtualServStatClientBytesOut ltmVirtualServStatClientBytesIn PoolPool æ˜¯ VS çš„èµ„æºæ± ï¼Œé€šè¿‡æŸç§è´Ÿè½½å‡è¡¡æ–¹å¼å°†è¯·æ±‚è½¬å‘è‡³æ± ä¸­çš„ Memberã€‚ Pool Statusèµ„æºæ± ä¹Ÿæ˜¯æœ‰çŠ¶æ€çš„ï¼Œä½†åªæœ‰å¯ç”¨çŠ¶æ€ï¼Œæ— è¿è¥çŠ¶æ€ã€‚ç›¸åº”çš„ï¼Œå…¶ OID å€¼æ˜¯ ltmPoolStatusAvailStateï¼Œæ± çš„çŠ¶æ€åŒæ ·åˆ—ä¸¾å¦‚ä¸‹ï¼š ICON å¯ç”¨çŠ¶æ€ å¯ç”¨çŠ¶æ€ä»£ç  æè¿° Avaliable GREENï¼ˆ0ï¼‰ æ± æˆå‘˜å¥åº·æ£€æŸ¥æ­£å¸¸ Unknown BLUEï¼ˆ4ï¼‰ æ± æˆå‘˜å¥åº·æ£€æŸ¥çŠ¶æ€æœªçŸ¥ Offline REDï¼ˆ3ï¼‰ æ± æˆå‘˜å¥åº·æ£€æŸ¥å¼‚å¸¸ å…³æ³¨èµ„æºæ± çš„çŠ¶æ€æ„ä¹‰ä¸å¤ªæ˜æ˜¾ï¼Œå› ä¸ºå°±ç›®å‰çš„æœåŠ¡å‘å¸ƒæ¶æ„ï¼ˆä¸€ä¸ª VS å¯¹åº”ä¸€ä¸ª Poolï¼‰ï¼Œæ± çŠ¶æ€å˜ä¸º Offline æ—¶ï¼ŒVS ä¸€å®šä¹Ÿä¼šå˜æˆ Offlineã€‚æ‰€ä»¥åŸºæœ¬ä¸Šåªéœ€è¦å…³æ³¨ Pool çš„ç»Ÿè®¡æ•°å­—å³å¯ã€‚ Pool StatisticsPool Statistics ä¸­çš„ç»Ÿè®¡æ•°å­—å¯ä»¥ä¸ºæ•´ä½“è¿è¥æ•°æ®æä¾›å¦ä¸€ä¸ªçº¬åº¦çš„æŒ‡æ ‡ï¼Œæ„ä¹‰ä¸å¦‚ VS Statistics é‚£æ ·æ˜æ˜¾ï¼Œå¯¹åº”çš„ OID å€¼å¦‚ä¸‹ï¼š ltmPoolLbMode ltmPoolStatusAvailState ltmPoolActiveMemberCnt ltmPoolStatServerCurConns ltmPoolStatTotRequests ltmPoolStatServerBytesOut ltmPoolStatServerBytesIn NodeNode æ˜¯ LTM ä¸­æœ€å°çš„ç²’åº¦ï¼Œå¯¹åº”çš„æ˜¯å®é™…çš„æœåŠ¡å™¨ï¼ˆReal Server or RSï¼‰ï¼ŒNode æ˜¯ Pool ä¸­çš„æˆå‘˜ï¼Œ Node Statusè¿™é‡Œè®¨è®ºçš„ Node çš„çŠ¶æ€åªåŒ…æ‹¬è¿è¥çŠ¶æ€ ltmNodeAddrStatusEnabledStateï¼Œå› ä¸ºåœ¨ç°å­˜æ¶æ„ä¸­ï¼ŒNode çš„å¯ç”¨çŠ¶æ€å¿…é¡»ç»“åˆ Pool çš„å¥åº·æ£€æŸ¥æ–¹å¼æ¥çœ‹ã€‚Node å¯ç”¨çŠ¶æ€ä¹Ÿå¯ä»¥å•ç‹¬è®¾å®šï¼Œä½†ä¸åœ¨æœ¬æ–‡çš„è®¨è®ºèŒƒå›´å†…ã€‚ ICON è¿è¥çŠ¶æ€ è¿è¥çŠ¶æ€ä»£ç  æè¿° é»‘è‰² Disabled disabled(1) å·²ç¦ç”¨ å…¶ä»– Enabled enabled(0) å·²å¯ç”¨ Node StatisticsNode çš„ç»Ÿè®¡æ•°å­—ä»…ä»…ä½œä¸ºå•æœºæµé‡çš„å‚è€ƒï¼Œä¸»è¦åŒ…æ‹¬ä¸‹é¢å‡ ä¸ª OID å€¼ï¼š ltmNodeAddrStatServerBytesIn ltmNodeAddrStatServerBytesOut ltmNodeAddrStatServerCurConns Pool Member Monitor Statuså…¶å®ç›¸æ¯” Pool Statusï¼Œæ›´æœ‰ç”¨çš„åº”è¯¥æ˜¯ Pool Member Monitor Statusï¼Œç”±äºæ‰€æœ‰çš„ä¸šåŠ¡å‡ç”± F5 ç»Ÿä¸€å‘å¸ƒï¼Œæ‰€ä»¥ F5 æœ‰ç€æœ€ä¸ºæ•é”ã€å®æ—¶çš„å¥åº·æ£€æŸ¥æœºåˆ¶ï¼šä¸€æ—¦å‘å¸ƒçš„æœåŠ¡ç«¯å£ä¸å¯ç”¨ï¼Œæˆ–å»¶è¿Ÿè¾ƒé«˜ï¼Œåˆ™é©¬ä¸Šå°†å…¶åœ¨ Pool ä¸­æ’é™¤ï¼Œä»¥å…å°†ç”¨æˆ·è¯·æ±‚åˆ†å‘åˆ°é—®é¢˜èŠ‚ç‚¹ï¼Œä»è€Œå¼•èµ·è®¿é—®è¶…æ—¶ç”šè‡³ä¸å¯ç”¨ã€‚ äºæ˜¯ï¼Œç›‘æ§ F5 çš„å¥åº·æ£€æŸ¥çŠ¶æ€ï¼Œæ¯”ç›´æ¥ä½¿ç”¨ Zabbix çš„ç«¯å£æ£€æµ‹æ›´åŠ ç›´æ¥ã€‚ä½†æ˜¯ï¼Œç”±äº F5 è‡ªå·±ä¼šæ’é™¤é—®é¢˜èŠ‚ç‚¹ï¼Œæ‰€ä»¥å•çº¯çš„èŠ‚ç‚¹æ•…éšœä¸ä¼šå¼•èµ·æ•´ä¸ªæœåŠ¡çš„å¼‚å¸¸ã€‚æ­¤ç›‘æ§äº§ç”Ÿçš„å‘Šè­¦ä»…ä»…éœ€è¦çŸ¥ä¼šç®¡ç†å‘˜ï¼ŒæŒ‰ç…§æˆ‘çš„ç›‘æ§å®šä¹‰ï¼Œç”ŸæˆäºŒçº§å‘Šè­¦å³å¯ã€‚ ICON å¯ç”¨çŠ¶æ€ å¯ç”¨çŠ¶æ€ä»£ç  æè¿° Availabe up(4) å¯ç”¨ Offline down (19) ä¸å¯ç”¨ Forced Down forcedDown (20) å·²ç¦ç”¨ä¸”ä¸å¯ç”¨ Pool Active Member Percentageç›®å‰çš„æœåŠ¡å‘å¸ƒæœºåˆ¶ï¼Œæ¯ä¸ª Pool ä¸­çš„æœåŠ¡å™¨æ•°é‡å‡åŸºæœ¬å¤§äº 3 ä¸ªï¼Œç›¸æ¯”å•çº¯çš„ Member Statusï¼Œå…³æ³¨ Pool ä¸­æ´»åŠ¨èŠ‚ç‚¹çš„æ¯”ä¾‹æ˜¾å¾—æ›´ä¸ºé‡è¦ã€‚ æœåŠ¡æ¶æ„è®¾è®¡ä¹‹åˆï¼Œå³è€ƒè™‘åˆ°äº†å…¶å†—ä½™æ€§ï¼Œæç«¯çŠ¶å†µä¸‹ï¼Œå…è®¸ä¸€åŠçš„èŠ‚ç‚¹åœæ­¢æœåŠ¡ï¼Œäºæ˜¯ Active Member Percentage å¯ä»¥é€šè¿‡æ´»åŠ¨èŠ‚ç‚¹æ•°é‡ ltmPoolActiveMemberCnt é™¤ä»¥å…¨éƒ¨èŠ‚ç‚¹æ•°é‡ ltmPoolMemberCnt æ¥è®¡ç®—å‡ºæ¥ã€‚ Alarm Policyæ ¹æ®ä¸Šè¿°å†…å®¹ï¼Œæˆ‘åˆ¶å®šå‡º F5 ç›‘æ§çš„å‘Šè­¦ç­–ç•¥ï¼Œåˆ†ä¸ºä¸€ã€äºŒã€ä¸‰çº§å‘Šè­¦ï¼Œåˆ†åˆ«å¯¹åº” Highã€Averageã€Warning ä¸‰ä¸ªå†…ç½®å‘Šè­¦çº§åˆ«ï¼š High VS Offline Pool Active Member Percentage &lt; 50% CPU Usage &gt; 80% Average Pool Member Monitor Status Offline Failover Status Failed Pool Offline Warning Pool Member Monitor Status Disabled ConfigSync Status NotSync Node Disabled VS Disabled","link":"/2019/03/24/Moniting-F5-with-Zabbix/"},{"title":"ç”¨Linuxåšè·¯ç”±å™¨","text":"ä»Šæ—¥å®Œæˆäº†ä¸€ä¸ªä¸“çº¿é¡¹ç›®, æ ¹æ®é›†å›¢è¦æ±‚, éœ€è¦ä½¿ç”¨ NAT çš„æ–¹å¼è”é€šä¸¤ä¸ªåŠå…¬åŒºä¹‹é—´çš„å†…éƒ¨ç½‘ç»œ, ä½¿å¾—å¯ä»¥äº’ç›¸è®¿é—®æœåŠ¡å™¨èµ„æº, å¹¶ä¸”ä¿å­˜3ä¸ªæœˆçš„ NAT æ—¥å¿—, å‡ºé—®é¢˜å¯ä»¥å¿«é€Ÿå®šä½åˆ°äºº. ç”±äºæˆ‘ä»¬åŠå…¬åŒºæ²¡æœ‰è·¯ç”±å™¨è®¾å¤‡, äºæ˜¯é‡‡ç”¨ Linux æœåŠ¡å™¨åš iptables è½¬å‘æ¥å®ç° NAT åŠŸèƒ½, å¹¶ä¸” iptables å¯ä»¥è®°å½•æ—¥å¿—; æ­¤é¡¹ç›®è®¾è®¡çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸è¶³ç™¾å°, ä¸ä¼šæœ‰å¤ªé«˜çš„å¹¶å‘è®¿é—®, ä¸€å°ä¸­ç­‰é…ç½®çš„ Linux æœåŠ¡å™¨å®Œå…¨å¯ä»¥æ»¡è¶³è¦æ±‚. æ‹“æ‰‘ç»“æ„ æˆ‘è´Ÿè´£çš„åŒºåŸŸåœ¨å·¦ä¾§. åŠå…¬åŒºå’Œæ€»éƒ¨é€šè¿‡ä¸€æ¡ 20M çš„ MSTP çº¿è·¯ç›¸è¿, äº’è”ç½‘æ®µæ˜¯172.17.176.48/29. åœ¨åŠå…¬åŒº10.250.0.0/16å¯ä»¥é€šè¿‡ SNAT æ–¹å¼è®¿é—®æ€»éƒ¨ç½‘ç»œ10.44.0.0/16, æº IP éœ€è¦ NAT ä¸º172.17.176.50/29 åœ¨æ€»éƒ¨å¯ä»¥é€šè¿‡è®¿é—®äº’è”åœ°å€172.17.176.51/29è®¿é—®åŠå…¬åŒºçš„æ•°æ®åº“æœåŠ¡å™¨10.250.8.241 åŸºæœ¬é…ç½®é¦–å…ˆåœ¨æˆ‘ä»¬10.250.0.0/16è¿™ä¸ªä¸‰å±‚äº¤æ¢æœºä¸Šå¢åŠ 10.44.0.0/16çš„è·¯ç”±: 1ip route-static 10.44.0.0 255.255.0.0 10.250.254.251 è‹¥è¦å®ç°åŒå‘çš„ NAT, è¿˜æœ‰ä¸€ä¸ªå¿…è¦æ¡ä»¶æ˜¯ä¸€å°æœ€å°åŒ–å®‰è£…çš„ Linux æœåŠ¡å™¨, æœ€å°‘é…ç½®2ä¸ªç½‘å¡, åœ¨æ­¤åœºæ™¯ä¸‹, ç½‘å¡é…ç½®ä¸º: eth0ä½œä¸ºå†…éƒ¨ç½‘å¡, IP åœ°å€æ˜¯10.250.254.251; eth1ä½œä¸ºäº’è”ç½‘å¡, IP åœ°å€æ˜¯172.17.176.50; eth1å¯¹ç«¯çš„ IP ä¸º172.17.176.49. æœåŠ¡å™¨çš„è·¯ç”±é…ç½®, éœ€è¦èƒ½å¤Ÿè®¿é—®åŠå…¬åŒºæ­£å¸¸çš„ç½‘ç»œèµ„æº, åŒæ—¶å°†10.44.0.0/16è·¯ç”±è‡³äº’è”ç½‘å¡: 1234567# netstat -nrKernel IP routing tableDestination Gateway Genmask Flags MSS Window irtt Iface172.17.176.48 0.0.0.0 255.255.255.248 U 0 0 0 eth110.250.254.0 0.0.0.0 255.255.255.0 U 0 0 0 eth010.44.0.0 172.17.176.49 255.255.0.0 UG 0 0 0 eth110.250.0.0 10.250.254.254 255.0.0.0 UG 0 0 0 eth0 å¼€å¯Linux å†…æ ¸çš„è½¬å‘åŠŸèƒ½, ç¼–è¾‘/etc/sysctl.conf, åŠ å…¥å¦‚ä¸‹è¯­å¥: 1net.ipv4.ip_forward = 1 è®¿é—®æ€»éƒ¨ç½‘ç»œèµ„æºæ­¤æ­¥éª¤æ¶‰åŠåˆ° SNAT çš„æ¦‚å¿µ. æ‰€è°“ SNAT, å³å°†ä¸€æ®µ IP åŒ…çš„æºåœ°å€æ”¹å˜, ç”±äºæ€»éƒ¨çš„ ACL ç­–ç•¥ä¸­ä»…å…è®¸172.17.176.48/29ç½‘æ®µè®¿é—®, æ‰€ä»¥æˆ‘ä»¬è®¿é—®æ€»éƒ¨æ—¶å°±å¿…é¡»å°†æºåœ°å€ NAT ä¸ºä¸Šè¿°ç½‘æ®µ. iptables çš„ nat tables æœ‰3ä¸ªå†…ç½®çš„ chain, åˆ†åˆ«æ˜¯PREROUTING, POSTROUTINGå’ŒOUTPUTchain PREROUTING chain â€“ Alters packets before routing. i.e Packet translation happens immediately after the packet comes to the system (and before routing). This helps to translate the destination ip address of the packets to something that matches the routing on the local server. This is used for DNAT (destination NAT).POSTROUTING chain â€“ Alters packets after routing. i.e Packet translation happens when the packets are leaving the system. This helps to translate the source ip address of the packets to something that might match the routing on the desintation server. This is used for SNAT (source NAT).OUTPUT chain â€“ NAT for locally generated packets on the firewall. æˆ‘ä»¬éœ€è¦ä½¿ç”¨çš„æ˜¯POSTROUTING chain. 1# iptables -A POSTROUTING -s 10.250.0.0/16 -o eth1 -j SNAT --to-source 172.17.176.50 è§£é‡Šä¸€ä¸‹, å°±æ˜¯å°†æ¥è‡ª10.250.0.0/16ç½‘æ®µçš„åŒ…, ç”± eth1 ç½‘å£å‡ºå»æ—¶çš„æº IP å˜æ›´ä¸º172.17.176.50; æˆ‘ä»¬ä¹‹å‰å·²ç»å°†è·¯ç”±é…ç½®ä¸ºè®¿é—®10.44ç½‘æ®µæ—¶éƒ½èµ° eth1, æ‰€ä»¥æ­¤è¡Œè§£å†³äº†è®¿é—®æ€»éƒ¨çš„é—®é¢˜. å¦‚æœæŸ¥çœ‹, å¯ä»¥çœ‹åˆ°æ­¤æ¡ç›®å·²ç»ç”Ÿæ•ˆ: 123# iptables -L -t nattarget prot opt source destinationNAT all -- 10.250.0.0/16 0.0.0.0/0 to:172.17.176.50 æ£€æŸ¥ç”Ÿæ•ˆåå¯ä»¥ä½¿ç”¨/etc/init.d/iptables save å°†æ­¤æ¡ä¿å­˜åˆ°/etc/sysconfig/iptables ä¸­, è¿™æ ·é‡å¯iptables åä¹Ÿä¸ä¼šä¸¢æ˜¯é…ç½®. æ€»éƒ¨è®¿é—®åŠå…¬åŒºæœåŠ¡å™¨æ­¤æ­¥éª¤ä¸ä»…æ¶‰åŠ SNAT, è¿˜æ¶‰åŠåˆ°äº† DNAT çš„æ¦‚å¿µ. DNAT å³å°†ä¸€æ®µ IP åŒ…çš„ç›®çš„åœ°å€æ”¹å˜. æ­¤æ–¹å¼","link":"/2014/02/07/NAT-on-linux/"},{"title":"ä¸œäº¬ç—…é™¢è§é—»å½•","text":"è¶ç€åœ¨ç—…æˆ¿é‡Œå¾…ç€æœ‰é—²æš‡æ—¶é—´ï¼Œè®°å½•ä¸€ä¸‹è¿™ç¬¬äºŒæ¬¡çš„è‚¾ç©¿åˆºæ´»æ£€æ‰‹æœ¯ï¼ˆKidney biopsyï¼‰çš„è§é—»ï¼Œä»¥åŠä¸åœ¨ä¸­å›½ç¬¬ä¸€æ¬¡æ‰‹æœ¯çš„åŒºåˆ«ï¼Œè°ˆè°ˆä¸­æ—¥ä¸¤å›½åŒ»ç–—åˆ¶åº¦çš„åŒºåˆ«ã€‚ æˆ‘çš„è‚¾è„ç—…ç—…å²ä»2020å¹´6æœˆä»½ç¬¬ä¸€æ¬¡å› é«˜çƒ§å‡ºç°è‚‰çœ¼è¡€å°¿å¼€å§‹ï¼Œæˆ‘å°±åšå¥½äº†ä¸æ…¢æ€§è‚¾ç‚ç›¸ä¼´ä¸€ç”Ÿçš„å‡†å¤‡ï¼Œ2020å¹´7æœˆæ¥åˆ°åŒ—äº¬å¤§å­¦äººæ°‘åŒ»é™¢è¿›è¡Œäº†ç¬¬ä¸€æ¬¡æ´»æ£€æ‰‹æœ¯ï¼Œç¡®è¯Šä¸º IgA è‚¾ç—…ã€‚ åŒ»å­¦ç•Œå¯¹äº IgA è‚¾ç—…çš„æˆå› æ™®éå­˜ç–‘ï¼Œä½†ä¸ªäººå›å¿†å¯èƒ½ä¸æˆ‘åœ¨å°å­¦æ—¶æ²‰è¿·äºç©è€åŒå­¦å¸¦æ¥çš„20å¤šå…‹æ¶²æ€æ±ç›¸å…³ï¼ˆæœªç»ä¸¥æ ¼è®ºè¯ï¼Œä»…ä»…æ˜¯çŒœæµ‹ï¼‰ã€‚ äº‹å·²è‡³æ­¤ï¼Œåšå¥½é¢„åæ‰æ˜¯å…³é”®ã€‚å¤§å¤«æ¯”è¾ƒä¿å®ˆï¼Œè®¤ä¸ºæˆ‘çš„è‚¾è„æŸä¼¤æ°´å¹³ï¼ˆeGFRï¼šè‚¾å°çƒæ»¤è¿‡ç‡ï¼‰è¿˜æ¯”è¾ƒæ—©æœŸï¼Œä½¿ç”¨äº†æœ€åŸºæœ¬çš„é™å‹å’Œé™è›‹ç™½è¯ï¼Œå¹¶æœªé‡‡ç”¨æ¿€ç´ æ²»ç–—ã€‚ ä¹‹å 10 æœˆä»½æ¥åˆ°æ—¥æœ¬ï¼Œå¼€å§‹äº†åœ¨æ—¥æœ¬çš„æ±‚åŒ»é—®è¯Šä¹‹è·¯ã€‚ åŒ»é™¢çš„é€‰æ‹©ç»è¿‡ä¸å„æ–¹æœ‹å‹çš„è®¨è®ºï¼Œå†³å®šäº†åŒ»é™¢çš„é€‰æ‹©ï¼ŒåŒæ—¶å°†æˆ¿å­ä¹°åˆ°è¿™é™„è¿‘ï¼Œä¾¿äºåç»­é•¿æœŸçš„é¢„åç–—ç¨‹ã€‚ æˆ‘æ¥åˆ°çš„è¿™å®¶åœ£è·¯åŠ å›½é™…åŒ»é™¢ï¼ˆSt. Lukeâ€™s International Hospitalï¼‰æ˜¯ä¸€å®¶éšå¤„å¯ä»¥è§åˆ°åœ£ç»çš„ï¼Œï¿¼å§‹å»ºäº 1901 å¹´çš„ç¾å›½åŒ»é™¢ã€‚é‡Œé¢çš„å¤§éƒ¨åˆ†åŒ»ç”Ÿå’ŒæŠ¤å£«éƒ½ä¼šè¯´è‹±è¯­ï¼ŒåŒ»é™¢è§„æ¨¡éå¸¸å¤§ï¼ŒåŒ»ç–—å’ŒåŒ»æŠ¤è®¾æ–½éå¸¸å¥½ã€‚ç¦»æˆ‘å®¶åªæœ‰5åˆ†é’Ÿè½¦ç¨‹ï¼Œå¯¹äºä¸ä¼šè¯´æ—¥è¯­çš„æˆ‘æ¥è¯´ï¼Œå¯ä»¥è¯´æ˜¯æœ€å¥½çš„é€‰æ‹©äº†ã€‚ å€¼å¾—ä¸€æçš„æ˜¯ï¼Œè¿™æ‰€åŒ»é™¢åœ¨ã€Šæ–°é—»å‘¨åˆŠã€‹ã€Œ2021å¹´å…¨çƒæœ€ä½³åŒ»é™¢ã€ä¸­æ’åç¬¬18ï¼Œæ—¥æœ¬ç¬¬äºŒï¼Œä»…æ¬¡äºè‘—åçš„ä¸œäº¬å¤§å­¦åŒ»å­¦éƒ¨é™„å±åŒ»é™¢ã€‚ï¼ˆæ¥æºï¼‰ æµç¨‹ä»ç¬¬ä¸€æ¬¡æ¥åˆ°åœ£è·¯åŠ ï¼Œåˆ°æœ€ç»ˆå†³å®šæ‰‹æœ¯ï¼Œè¿›è¡Œäº†å¤§çº¦åŠå¹´å·¦å³çš„ç ”ç©¶å’Œè§‚å¯Ÿã€‚æœ€å¼€å§‹åªæ˜¯ç»´æŒäººæ°‘åŒ»é™¢çš„è¯Šæ–­ç»“æœï¼Œæœç”¨ç›¸åŒçš„è¯ç‰©ã€‚åœ¨æ³¨å°„å®Œç¬¬äºŒé’ˆ Moderna æ–°å† ç–«è‹—å‡ºç°è¡€å°¿ä¹‹åï¼ŒåŒ»ç”Ÿå†³å®šå†æ¬¡æ‰‹æœ¯ç¡®å®šç—…ç†ã€‚ä¸­å›½çš„æ´»æ£€ç»“æœåœ¨ä»–çœ‹æ¥ï¼Œä¼¼ä¹å¹¶ä¸å…·å¤‡å‚è€ƒä»·å€¼ã€‚ æ‰‹æœ¯å‰1ä¸ªæœˆå·²ç»è¿›è¡Œäº†å¿…è¦çš„æ£€æµ‹ï¼ˆè¡€å¸¸è§„ã€å°¿å¸¸è§„ã€ç”ŸåŒ–ã€å¿ƒç”µå›¾ã€å…ç–«ã€CTã€Echo ç­‰ç­‰ç­‰ç­‰ï¼‰ï¼Œæ‰‹æœ¯è¿‡ç¨‹åªéœ€è¦2æ³Š3æ—¥çš„ä½é™¢æ—¶é—´ï¼Œç¡®å®šæœ¯åæ²¡æœ‰å‡ºè¡€å³å¯å‡ºé™¢ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œåœ¨äººæ°‘åŒ»é™¢çš„ä½é™¢é˜¶æ®µæŒç»­äº†7å¤©ã€‚ æ‰‹æœ¯å½“å¤©ç”±äºæˆ‘å¤ªç´§å¼ äº†ï¼Œæ‰€æœ‰æµç¨‹éƒ½æå‰äº†1ä¸ªå°æ—¶è¿›è¡Œã€‚8ç‚¹é’Ÿæ¥åˆ°åŒ»é™¢ç­‰å¾…ä½é™¢éƒ¨å¼€é—¨ï¼Œäº¤äº†10ä¸‡æ—¥å…ƒæŠ¼é‡‘ï¼Œä¹‹åç”±å·¥ä½œäººå‘˜å¸¦é¢†æ¥åˆ°10å±‚è‡ªå·±çš„ç—…æˆ¿é‡Œï¼Œç­‰å¾…åŒ»ç”Ÿçš„åˆ°æ¥ã€‚ ç—…æˆ¿æ˜¯å…è´¹çš„ï¼ˆå¦‚æœå…è´¹ç—…æˆ¿ä½æ»¡äº†ï¼Œä¼šå®‰æ’æ”¶è´¹ç—…æˆ¿ï¼Œæ¯å¤© 33000 æ—¥å…ƒæœ€å°‘ï¼‰ï¼Œå±‹å†…é¢ç§¯å¾ˆå°ä½†è®¾æ–½ç›¸å½“é½å…¨å’Œè±ªåï¼Œä¸æˆ‘åœ¨äººæ°‘åŒ»é™¢æ—¶çš„3äººé—´ç—…æˆ¿ç›¸æ¯”ç®€ç›´å¤©å£¤ä¹‹åˆ«ï¼Œåè€…è¿˜è¦æ¯å¤©1000äººæ°‘å¸å·¦å³çš„æˆ¿é—´è´¹ã€‚ æ‰‹æœ¯è¿‡ç¨‹å…¨ç¨‹åœ¨ç—…æˆ¿é‡Œè¿›è¡Œã€‚åºŠå¤´æœ‰æ— å½±ç¯ã€ç—…åºŠä¸Šæœ‰å„ç±»æ¥å£ã€å±‹å†…ä¹Ÿæœ‰ä¸€äº›å°å‹è®¾å¤‡ï¼Œä¸ºæ‰‹æœ¯æä¾›äº†æ‰€éœ€çš„ç¯å¢ƒï¼Œä¸å¿…åœ¨è½¦ä¸Šè¢«æ¨æ¥æ¨å»ï¼Œæ„Ÿè§‰éå¸¸å¥½ã€‚ æŠ¤å£«ç»™æˆ‘åŸ‹ä¸‹äº†é™è„‰æ»ç•™é’ˆï¼Œå¼€å§‹ç‚¹æ»´ï¼Œä¼¼ä¹æ˜¯æœ‰æ­¢ç—›é•‡é™æˆåˆ†ï¼›ä¹‹åè¿›è¡Œäº†ä¸€æ¬¡ç®€å•çš„é‡‡è¡€ã€ä½“æ¸©è¡€å‹å’Œè¡€æ°§æµ‹é‡ï¼›ç„¶åè¿›æ¥çš„æ‰‹æœ¯å›¢é˜Ÿå°±æŠŠæˆ‘æ¥ç®¡äº†ã€‚ æœ‰ 5-6 ååŒ»ç”Ÿç»™æˆ‘è¿›è¡Œæ‰‹æœ¯ï¼ŒæœŸé—´åŒ»ç”Ÿå¬æˆ‘ä¸€ç›´è¯´ surgery ç»™æˆ‘è§£é‡Šï¼šä¸¥æ ¼æ¥è¯´ï¼ŒKidney Biopsy ä¸ç®—æ‰‹æœ¯ï¼Œä»…ä»…æ˜¯æ‹¿ä¸€æ ¹é’ˆåˆºåˆ°è‚¾è„é‡Œï¼Œå–ä¸€å—æˆ–å¤šå—æ´»ä½“ç»„ç»‡ï¼Œæ‹¿åˆ°æ˜¾å¾®é•œä¸‹è§‚çœ‹å®ƒçš„ç»“æ„å’ŒæŸä¼¤æƒ…å†µï¼Œæ¥ç¡®å®šå…·ä½“çš„è‚¾è„ç—…ç†å’Œæ²»ç–—æ–¹æ¡ˆçš„æ‰‹æ®µï¼Œæœ€å¤šåªæ˜¯ä¸ª operationã€‚ æ‰‹æœ¯å®æ–½è¿‡ç¨‹ä¸­é™¤äº†éº»è¯é‚£3é’ˆç¨å¾®æœ‰ç‚¹åˆºç—›æ„Ÿï¼Œå…¶ä½™æ—¶é—´æ¯«æ— çŸ¥è§‰ï¼Œé™¤äº†æˆ‘ç´§ç»·çš„è‚Œè‚‰è®©å¥¹ç‰¹åˆ«ç”¨åŠ›æé†’æˆ‘æ”¾æ¾ä¹‹å¤–ï¼Œä¸åœ¨å›½å†…çš„æ„Ÿè§‰å¤§è‡´ç›¸åŒã€‚ä½†å›½å†…é‚£æ¬¡æ‰‹æœ¯ï¼Œæˆ‘èƒ½æ˜æ˜¾çš„æ„Ÿè§‰åˆ°è‚¾è„è¢«æŠ“äº†ä¸€ä¸‹ï¼Œè€Œè¿™æ¬¡æ²¡æœ‰ã€‚åŒ»ç”Ÿé‡‡é›†äº†3å—è‚¾è„ç»„ç»‡ï¼Œè§‚å¯Ÿäº†æ²¡æœ‰å‡ºè¡€ç°è±¡åï¼Œæ»¡æ„ç¦»å¼€ã€‚ å§åºŠ24å°æ—¶æœ€ç—›è‹¦çš„è¿‡ç¨‹åè€Œæ˜¯æ‰‹æœ¯åçš„å§åºŠé˜¶æ®µã€‚å‰6ä¸ªå°æ—¶ç”šè‡³ä¸å¯ä»¥ç§»åŠ¨åŒè…¿ï¼Œä¹‹åçš„18å°æ—¶ä¸å¯ä»¥ç¿»èº«ï¼Œå¿…é¡»å¹³èººï¼Œè…¿ä¸Šç»‘äº†é¢„é˜²è¡€æ “çš„è‡ªåŠ¨æŒ‰æ‘©è£…ç½®ã€‚æœ¯åçš„æ™šä¸Šæˆ‘ä¸€å¤œæœªçœ ï¼ŒåèƒŒç–¼åˆ°æ— æ³•å…¥ç¡ï¼Œåƒé¥­å’Œæ’å°¿ä¹Ÿæ˜¯ä¸¤ä¸ªæ¯”è¾ƒå¤§çš„é—®é¢˜ï¼Œå¹³æ—¶é¡ºç†æˆç« çš„äº‹æƒ…ï¼Œèººä¸‹äº†å°±å˜å¾—ä¸ä¸€æ ·äº†ï¼šç‰¹åˆ«æ˜¯æ’å°¿å¦‚æœä¸é¡ºåˆ©ï¼Œè¿˜è¦ä¸Šå™©æ¢¦èˆ¬çš„å°¿ç®¡ï¼Œç®€ç›´æ˜¯å¤„åˆ‘ã€‚ æ„Ÿè°¢è¿‡ç¨‹ä¸­å¯¹æˆ‘æ‚‰å¿ƒç…§æ–™çš„çµè¡£æŠ¤å£«ï¼Œè®©æˆ‘è¿™éš¾ç†¬çš„24å°æ—¶å˜å¾—å¥½å—äº†ä¸€ç‚¹ã€‚ æ—¥æœ¬åŒ»é™¢çš„æŠ¤å£«å¤§æ¦‚ç›¸å½“äºå›½å†…ç—…æˆ¿é‡Œçš„æŠ¤å£«+æŠ¤å·¥ã€‚çµè¡£å¦¹å¦¹çš„å·¥ä½œéå¸¸çš„ç»†è‡´å’Œä½“è´´ï¼Œä¹Ÿéå¸¸çš„è¾›è‹¦ï¼šåŠªåŠ›åœ°ä½¿ç”¨ç¿»è¯‘è½¯ä»¶ï¼Œç”¨ä¸­æ–‡åœ¨é»‘æ¿ä¸Šå†™ä¸‹äº†æ³¨æ„äº‹é¡¹ï¼›å¸®æˆ‘æŠŠä¸å®¹æ˜“èººç€åƒçš„ç±³é¥­äº²æ‰‹æ‰æˆäº†é¥­å›¢ğŸ™ï¼›æ¸©æŸ”çš„å¸®æˆ‘æŒ‰æ‘©èƒŒéƒ¨å’Œå±è‚¡ï¼›èººç€æ’å°¿ä¼šè·Ÿæˆ‘è¯´é ‘å¼µã£ã¦ï¼Œé¡ºåˆ©å®Œæˆåè¿˜ä¼šè¯´ã™ã”ã„ã€‚ï¼ˆè™½ç„¶å¾ˆæ¥ãšã‹ã—ã„ä½†æ˜¯è¯·å’Œæˆ‘ç»“å©šå§ï¼çµè¡£ã¡ã‚ƒã‚“ï¼ï¼‰ å‰©ä¸‹1å¤©çš„ï¼Œæ‚ é—²çš„ä½é™¢æ—¶å…‰ç†¬è¿‡äº†24å°æ—¶ï¼Œé¡ºåˆ©ä¸‹åºŠåï¼Œå°±å¯ä»¥åœ¨åŒ»é™¢å†…è‡ªç”±æ´»åŠ¨äº†ã€‚åƒè…»äº†ä½è›‹ç™½é¤ï¼Œäºæ˜¯å»åƒäº†åŒ»é™¢é¤å…çš„å®šé£Ÿåˆé¤ï¼Œå» 7-11 ä¹°äº†ç‚¹ç”œå“ï¼Œå»æ˜Ÿå·´å…‹ä¹°äº†æ¯å’–å•¡ï¼Œå¸¦åˆ°ç—…æˆ¿çš„çª—å‰ï¼Œäº«å—èµ·äº†éš¾å¾—çš„æ‚ é—²æ—¶å…‰ã€‚ è¿™ä¸¤å¤©çš„ä½é™¢çœŸæ­£ä½“ä¼šåˆ°äº†é¡¶çº§åŒ»ç–—æœºæ„çš„æœåŠ¡èƒ½åŠ›ï¼Œå†åŠ ä¸Šæ—¥æœ¬æ˜¯ä¸ªæ³¨é‡æœåŠ¡çš„å›½å®¶ï¼Œè¿‡ç¨‹å¯ä»¥è¯´æ˜¯éå¸¸çš„äº«å—ã€‚æ˜å¤©ç¦»é™¢æ—¶å°†è¦é¢ä¸´ä¿é™©å’Œè´¹ç”¨ç›¸å…³çš„å¤æ‚æµç¨‹ï¼Œå±Šæ—¶å†æ¥æ›´æ–°ã€‚","link":"/2022/02/04/Records_of_the_Tokyo_Hospital_01/"},{"title":"ä½¿ç”¨ä¸€å°Raspberry Piä½œä¸ºå®¶åº­ç½‘å…³, æ— éšœç¢ç¿»å¢™","text":"Arthor: Archean Zhang Email: zephyr422@gmail.com Version: 1.0.1 Date: 2013/8/16 é•¿æœŸè¢«GFWå›°æ‰°, æˆ‘ç»ˆäºå¿ä¸ä½åŠ¨æ‰‹äº†: æŠŠå®¶é‡Œçš„Raspberry Piå’Œä¸è‡ªç”±ä¸–ç•Œçš„ä¸»æœºå»ºç«‹OpenVPN over Stunnelçš„é“¾è·¯, æ ¹æ®å¤§ä¸­å3000æ¡è·¯ç”±æ¥åŒ¹é…, å›½å¤–ç½‘ç«™è‡ªåŠ¨èµ°OpenVPNå‡ºå»ä»¥å®ç°ç¿»å¢™. ä»¥ä¸‹æ–‡ç« æ˜¯åŸºäºä¸€å°LinuxæœåŠ¡å™¨(CentOS 6.4)æ’°å†™çš„, å°†ä¸‹é¢Routerçš„æ¢æˆRaspberry Piä¹Ÿä¸€æ ·. 1. å‡†å¤‡ç¡¬ä»¶: 1å°ä½äºè‡ªç”±ä¸–ç•Œçš„LinuxæœåŠ¡å™¨ (Server) 1å°ä½äºæœ¬åœ°çš„LinuxæœåŠ¡å™¨ (Router) å®¢æˆ·ç«¯ (Client) è½¯ä»¶: Stunnel OpenVPN DNSMasq æ‹“æ‰‘å›¾: 2. Serverç«¯é…ç½®å®‰è£…å¥½Linuxç³»ç»Ÿå(Red hatæˆ–CentOS), åŒæ­¥æœåŠ¡å™¨æ—¶é—´(éå¸¸é‡è¦): 1# ntpdate time.nist.gov 2.1 OpenVPNä¸‹è½½å®‰è£…OpenVPN, ç”ŸæˆæœåŠ¡å™¨ç«¯è¯ä¹¦, OpenVPNä¾èµ–lzo, éœ€è¦ä¸€åŒå®‰è£…: 12# yum install lzo openvpn æœåŠ¡å™¨ç«¯é…ç½®æ–‡ä»¶/etc/openvpn/server.conf, èŒƒä¾‹åŠè¯´æ˜å¦‚ä¸‹: 1234567891011121314151617local 127.0.0.1 #ç›‘å¬æœ¬åœ°æ¥å£port 4443 #ç›‘å¬ç«¯å£proto tcp #åè®®dev tap ca /etc/openvpn/keys/ca.crt #è¯ä¹¦cert /etc/openvpn/keys/server.crt #è¯ä¹¦dh /etc/openvpn/keys/dh1024.pem #è¯ä¹¦server 172.31.189.0 255.255.255.0 #ç½‘æ®µclient-to-clientduplicate-cnkeepalive 10 120comp-lzopersist-keypersist-tunstatus openvpn-status.log #çŠ¶æ€æ—¥å¿—log-append openvpn.log #æ‰§è¡Œæ—¥å¿—verb 3 å¯åŠ¨openvpn: 1# openvpn --config /etc/openvpn/server.conf --deamon è§‚å¯Ÿæ—¥å¿—, å¦‚æœå‡ºç°â€œInitialization Sequence Completedâ€åˆ™ä»£è¡¨å¯åŠ¨æˆåŠŸ. 2.2 StunnelOpenvpnçš„Serverç«¯åªç›‘æ§æœ¬åœ°æ¥å£, å°±æ˜¯ä¸ºäº†ç”¨Stunnelå°†æµé‡åŠ å¯†, åœ¨Localç«¯å®‰å…¨çš„é“¾æ¥, è¾¾åˆ°åŠ å¯†, æ··æ·†æµé‡çš„ä½œç”¨, ä»¥ç»•å¼€GFWçš„ç›‘æ§. ä¸‹è½½å®‰è£…stunnel 12# yum install stunnel å®‰è£…è¿‡ç¨‹ä¸­ä¼šç”ŸæˆæœåŠ¡å™¨è¯ä¹¦stunnel.pem, æŒ‰ç…§æç¤ºæ¥å³å¯. ç¼–è¾‘é…ç½®æ–‡ä»¶/usr/bin/etc/stunnel.conf, å¦‚ä¸‹æ‰€ç¤º: 1234567891011121314151617181920212223cert = /usr/local/etc/stunnel/stunnel.pemCAfile = /usr/local/etc/stunnel/stunnel.pemsocket = l:TCP_NODELAY=1socket = r:TCP_NODELAY=1pid = /tmp/stunnel.pidverify = 3setuid = stunnelsetgid = stunnelcompression = zlibdelay = nosslVersion = TLSv1fips=nodebug = 7syslog = nooutput = /usr/local/etc/stunnel/stunnel.log[s-openvpn] accept = 13579 #ç›‘å¬ç«¯å£connect = 127.0.0.1:4443 #OpenVPNç«¯å£ å¯åŠ¨stunnel: 1# stunnel æŸ¥çœ‹OpenVPNå’ŒStunnelæ˜¯å¦æ­£ç¡®æ‰§è¡Œ, æ£€æŸ¥ç›¸åº”ç«¯å£: 1234567891011# netstat -ntwlaActive Internet connections (servers and established)Proto Recv-Q Send-Q Local Address Foreign Address State tcp 0 0 0.0.0.0:13579 0.0.0.0:* LISTEN tcp 0 0 127.0.0.1:4443 127.0.0.1:50223 ESTABLISHED # lsof -i:4443 -nCOMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAMEopenvpn 25290 root 5u IPv4 2982393 0t0 TCP *:pharos (LISTEN)openvpn 25290 root 8u IPv4 3361561 0t0 TCP 127.0.0.1:pharos-&gt;127.0.0.1:50223 (ESTABLISHED)stunnel 26801 stunnel 10u IPv4 3361560 0t0 TCP 127.0.0.1:50223-&gt;127.0.0.1:pharos (ESTABLISHED) çœ‹åˆ°ç«¯å£å‡å·²æ­£ç¡®ç›‘å¬, è‡³æ­¤Serverç«¯é…ç½®å®Œæˆ 3. Routeré…ç½®å®‰è£…å¥½Linuxç³»ç»Ÿå(Red hatæˆ–CentOS), åŒæ­¥æœåŠ¡å™¨æ—¶é—´(éå¸¸é‡è¦): 12# ntpdate time.nist.gov 3.1 å®‰è£…StunnelRouterç«¯éœ€è¦é¦–å…ˆå®‰è£…Stunnel, åœ¨æœ¬åœ°å¼€å¯åŠ å¯†é“¾è·¯, é€ä¼ OpenVPNåŠ å¯†ç«¯å£4443, ç„¶åOpenVPNæ‰èƒ½å¼€å§‹æ¥å…¥: 1# yum install stunnel å°†Serverç«¯Stunnelè¯ä¹¦ä¼ è¿‡æ¥, ä»¥ä¾¿éªŒè¯: 1# scp root@server:/usr/local/etc/stunnel.pem root@router:/usr/local/etc/stunnel.pem å¼€å§‹è¿›è¡Œstunnelé…ç½®, é…ç½®æ–‡ä»¶/usr/local/etc/stunnel.conf: 1234567891011121314151617pid = /tmp/stunnel.pidcert = /usr/local/etc/stunnel/stunnel.pemsocket = l:TCP_NODELAY=1socket = r:TCP_NODELAY=1verify = 3CAfile = /usr/local/etc/stunnel/stunnel.pemclient=yescompression = zlibciphers = AES256-SHAdelay = nofailover = priosslVersion = TLSv1output = /root/bin/logs/stunnel.log[s-openvpn]accept = 127.0.0.1:4443connect = server.ip.address:13579 å¯åŠ¨stunnel: 1# stunnel 3.2 å®‰è£…OpenVPNä¸‹è½½å®‰è£…OpenVPN, OpenVPNä¾èµ–lzo, éœ€è¦ä¸€åŒå®‰è£…: 1# yum install lzo openvpn é…ç½®Routerç«¯é…ç½®æ–‡ä»¶/etc/openvpn/hk.ovpn: 123456789101112131415161718dev tap #è®¾å¤‡æ¨¡å¼port 65530 #æœ¬åœ°ç›‘å¬ç«¯å£proto tcp #åè®®client #æœåŠ¡æ¨¡å¼:clienttls-client #åŠ å¯†å®¢æˆ·ç«¯ns-cert-type server remote 127.0.0.1 4443 #Serverç«¯å£, ç”±äºä½¿ç”¨StunnelåŠ å¯†é€ä¼ , æ‰€ä»¥è¿æ¥æœ¬åœ°ç«¯å£ca /etc/openvpn/ca/ca.crt #è¯ä¹¦key /etc/openvpn/ca/client1.key #è¯ä¹¦cert /etc/openvpn/ca/client1.crt #è¯ä¹¦persist-keypersist-tun#route-method exe#route-delay 2comp-lzostatus /etc/openvpn/openvpn-status.log #çŠ¶æ€æ—¥å¿—log-append /etc/openvpn/ca.log #æ‰§è¡Œæ—¥å¿—verb 3 å¯åŠ¨OpenVPN: 1# openvpn --daemon --config /etc/openvpn/hk.ovpn è§‚å¯Ÿæ—¥å¿—, å¦‚æœå‡ºç°â€œInitialization Sequence Completedâ€åˆ™ä»£è¡¨å¯åŠ¨æˆåŠŸ. æ£€æŸ¥éš§é“: 123456789101112131415# ip addr11: tap0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN qlen 100 link/ether 06:10:50:e5:e5:2c brd ff:ff:ff:ff:ff:ff inet 172.31.188.2/24 brd 172.31.188.255 scope global tap0 inet6 fe80::410:50ff:fee5:e52c/64 scope link valid_lft forever preferred_lft forever # ping 172.31.188.1PING 172.31.188.1 (172.31.188.1) 56(84) bytes of data.64 bytes from 172.31.188.1: icmp_seq=1 ttl=64 time=67.3 ms64 bytes from 172.31.188.1: icmp_seq=2 ttl=64 time=67.1 ms^C--- 172.31.188.1 ping statistics ---2 packets transmitted, 2 received, 0% packet loss, time 1588msrtt min/avg/max/mdev = 67.183/67.284/67.386/0.278 ms é“¾è·¯é€šç•… 3.3 å®‰è£…DNSmasqRouterè‹¥è¦è¿›è¡Œç¿»å¢™, éœ€è¦ä½¿ç”¨å›½å¤–DNS, è€Œæµè§ˆå›½å†…ç½‘ç«™æ—¶, å¦‚æœä½¿ç”¨å›½å¤–DNS, ä¼šé€ æˆå°†è®¿é—®å¯¼å‘å›½å¤–ç«™ç‚¹, é€ æˆè®¿é—®é€Ÿåº¦å˜æ…¢, æ‰€ä»¥æ­¤æ–¹æ¡ˆä½¿ç”¨DNSmasqè§£å†³æ­¤é—®é¢˜. åŒæ—¶DNSmasqä¹Ÿæ˜¯ä¸€ä¸ªè½»é‡çº§DHCPæœåŠ¡å™¨, éå¸¸æ–¹ä¾¿å¥½ç”¨. å®‰è£…DNSmasq: 1# yum install dnsmasq ç¼–è¾‘DNSmasqé…ç½®æ–‡ä»¶/etc/dnsmasq.conf, å‡è®¾Routeræœ¬åœ°IPæ˜¯10.2.166.10, æœ¬åœ°åˆ†å‘ç½‘æ®µæ˜¯10.2.166.0/24, åˆ™é…ç½®å¦‚ä¸‹: 12345678910111213141516171819202122# DHCP configexpand-hostsdomain=archean.me# DHCP Rangedhcp-range=10.2.166.50,10.2.166.150,12h #DHCPåœ°å€æ± # DHCP routedhcp-option=3,10.2.166.10 #è·¯ç”±# Apple ntp serverdhcp-option=option:ntp-server,10.3.1.233 #ntpæ—¶é—´æœåŠ¡å™¨# DNS serverno-resolvno-pollserver=8.8.8.8server=8.8.4.4conf-dir=/etc/dnsmasq.d# AppleTV trailersaddress=/trailers.apple.com/180.153.225.136# Static IPs# dhcp-host=xx:xx:xx:xx:xx:xx,10.2.166.121 é…ç½®åˆ†ç±»è§£æé…ç½®æ–‡ä»¶/etc/dnsmasq.d/china.conf, ä»¥ä½¿å¸¸ç”¨åŸŸåèµ°å›½å†…DNSè§£æ, ä¸¾ä¾‹å¦‚ä¸‹, æ ¹æ®è‡ªèº«æƒ…å†µæ›´æ”¹: 1234567891011# server=/domain.name/dns.serverserver=/115.com/114.114.114.114server=/123u.com/114.114.114.114server=/126.com/114.114.114.114server=/126.net/114.114.114.114server=/163.com/114.114.114.114server=/17173.com/114.114.114.114server=/17cdn.com/114.114.114.114server=/51.la/114.114.114.114server=/6rooms.com/114.114.114.114server=/91.com/114.114.114.114 è‡³æ­¤å‡†å¤‡å·¥ä½œå®Œæˆ, å¯ä»¥å¯åŠ¨è·¯ç”±å™¨äº† 3.4 å¯åŠ¨è·¯ç”±å™¨æ€è·¯ é»˜è®¤è·¯ç”±ä¸ºOpenVPN Serverç«¯ç§ç½‘IP, chnrouteç”Ÿæˆçš„3000æ¡å›½å†…è·¯ç”±èµ°å›½å†…é“¾è·¯, ä»¥è¾¾åˆ°åˆ†æµ/ç¿»å¢™çš„ç›®çš„. æ­¥éª¤: å¯åŠ¨Stunnel, å¯åŠ¨DNSmasq å¼€å¯linuxå†…æ ¸è½¬å‘åŠŸèƒ½ å¯åŠ¨OpenVPN å¢åŠ 3000æ¡å›½å†…è·¯ç”±(ç‚¹è¿™é‡Œä¸‹è½½) å¢åŠ é»˜è®¤è·¯ç”±, å¢åŠ ä¸‹ä¸€è·³ä¸ºOpenVPN Serverç«¯ç§ç½‘IP å°†æ­¥éª¤ç¼–å†™æˆè„šæœ¬, å¦‚ä¸‹: 1234567891011121314151617181920212223#!/bin/sh# Stunnel up/usr/bin/stunnel/usr/sbin/dnsmasq# date ntp timentpdate ntp.server.name/sbin/route add -net 10.0.0.0/8 gw 10.2.166.1/sbin/route add -host server.ip.address gw 10.2.166.1# iptables NAT/sbin/iptables -t nat -A POSTROUTING -o tap0 -j MASQUERADEsysctl -w net.ipv4.ip_forward=1# start Openvpnkillall openvpn/usr/local/sbin/openvpn --daemon --config /etc/openvpn/hk.ovpnsleep 5# Chnroutersfor i in `cat /root/bin/CN` ; do /sbin/route add -net $i gw 10.2.166.1 ; done/sbin/route del default/sbin/route add default gw 10.2.166.1/sbin/route add default gw 172.31.188.1 å¯åŠ¨è„šæœ¬, Routerç¯å¢ƒæ­å»ºå®Œæˆ, å›½å¤–ç½‘ç»œè®¿é—®æµ‹è¯•: 1234567891011# tracert 8.8.8.8traceroute to 8.8.8.8 (8.8.8.8), 30 hops max, 60 byte packets 1 172.31.188.1 (172.31.188.1) 68.963 ms 68.913 ms 68.914 ms 2 103.30.4.1 (103.30.4.1) 109.650 ms 109.651 ms 109.645 ms 3 172.16.0.2 (172.16.0.2) 109.410 ms 109.454 ms 109.448 ms 4 gi1-26.br02.hkg04.pccwbtn.net (63.218.241.1) 109.384 ms 109.384 ms 109.465 ms 5 72.14.196.197 (72.14.196.197) 109.415 ms 109.381 ms 109.344 ms 6 209.85.241.56 (209.85.241.56) 109.368 ms 209.85.241.58 (209.85.241.58) 105.488 ms 149.385 ms 7 216.239.43.17 (216.239.43.17) 108.792 ms 68.841 ms 209.85.253.69 (209.85.253.69) 69.430 ms 8 * * * 9 google-public-dns-a.google.com (8.8.8.8) 108.102 ms 107.936 ms 107.819 ms å¯ä»¥çœ‹åˆ°ç›´æ¥èµ°OpenVPNç§ç½‘IPå‡ºå», å›½å†…ç½‘ç»œè®¿é—®æµ‹è¯•: 1234567891011121314# traceroute www.baidu.comtraceroute to www.baidu.com (115.239.210.26), 30 hops max, 60 byte packets 1 10.2.166.1 (10.2.166.1) 2.267 ms 2.470 ms 2.623 ms 2 10.2.255.254 (10.2.255.254) 2.180 ms 2.492 ms 2.648 ms 3 * * * 4 * * * 5 * * * 6 123.125.40.254 (123.125.40.254) 2.714 ms 2.634 ms 2.883 ms 7 61.49.44.65 (61.49.44.65) 1.459 ms 1.448 ms 1.521 ms 8 61.148.160.5 (61.148.160.5) 1.443 ms 1.466 ms 1.459 ms 9 124.65.60.77 (124.65.60.77) 3.258 ms 5.805 ms 5.790 ms 10 123.126.0.85 (123.126.0.85) 3.392 ms 3.202 ms 3.245 ms11 123.126.0.85 (123.126.0.85) 3.214 ms 5.487 ms 3.913 ms12 219.158.35.90 (219.158.35.90) 71.347 ms 71.338 ms 71.337 ms å›½å†…é“¾è·¯åˆ™ç›´æ¥èµ°åŸæœ¬çš„ç½‘ç»œç¯å¢ƒå‡ºå». 3.5 é…ç½®ç›‘æ§è„šæœ¬ç”±äºå›½é™…å‡ºå£ä¸ä¸€å®šç¨³å®š, OpenVPNæœ‰å¯èƒ½ä¼šé—´æ­‡æ€§æ–­æ‰, å¦‚æœå‘ç”Ÿæ­¤æƒ…å†µ, åˆ™ä¼šé€ æˆé»˜è®¤è·¯ç”±ä¸å¯è¾¾, ä»è€Œå¯¼è‡´å›½å†…ç½‘ç«™æµè§ˆä¹Ÿä¼šå‡ºç°é—®é¢˜, æ‰€ä»¥é…ç½®ç›‘æ§è„šæœ¬, ä¸€æ—¦å›½é™…é“¾è·¯æŠ½é£, åˆ™ç«‹åˆ»å°†è·¯ç”±åˆ‡æ¢è‡³å›½å†…. è„šæœ¬å†…å®¹å¦‚ä¸‹: 1234567891011121314151617181920212223#!/bin/bash ip=&quot;172.31.188.1&quot; i=-1 j=-1 while : ; do ping $ip -c 5 -w 30 if [ $? -ge &quot;1&quot; ]; then route del default gw $ip j=-1 i=$((i+1)) txt=`date +%F&quot; &quot;%X`&quot; Ping $ip timed out.&quot; (($i%30==0)) &amp;&amp; echo $txt &gt;&gt; /root/bin/logs/checkip.log (($i%30==0)) &amp;&amp; echo $txt | mailx -s &quot;VPN disconnected&quot; admin@domain.com else route add default gw $ip i=-1 j=$((j+1)) txt=`date +%F&quot; &quot;%X`&quot; Ping $ip OK.&quot; (($j%30==0)) &amp;&amp; echo $txt &gt;&gt; /root/bin/logs/checkip.log (($j%100000==0)) &amp;&amp; echo $txt | mailx -s &quot;VPN OK.&quot; admin@domain.com fi sleep 10 done åå°å¯åŠ¨æ­¤è„šæœ¬, åˆ™ä¼šæ¯10ç§’ç›‘æ§ä¸€æ¬¡å‡ºå›½é“¾è·¯, å¦‚æœæ–­æ‰, å°†ä¼šæŠŠè·¯ç”±åˆ‡è‡³å›½å†…, ä¸å½±å“æ­£å¸¸ä¸Šç½‘; å¦‚æœå‡ºå›½é“¾è·¯é•¿æœŸæ— æ³•æ¢å¤, åˆ™æ¯5åˆ†é’Ÿç»™ç®¡ç†å‘˜å‘é€ä¸€å°å‘Šè­¦é‚®ä»¶. 4. Clientå®¢æˆ·ç«¯æ¥å…¥è·¯ç”±å™¨æ‰€åœ¨äº¤æ¢æœºå, é…ç½®ä¸ºè‡ªåŠ¨è·å–IPåœ°å€, å³å¯è¿›è¡Œç¿»å¢™.","link":"/2013/10/16/breaking-gfw-with-raspberry-pi/"},{"title":"Docker å­¦ä¹ ç¬”è®°","text":"æœ€è¿‘å…¬å¸çš„ä¸€äº›æœåŠ¡å°†è¦è¿ç§»è‡³ Docker å¹³å°ï¼Œä¸ºäº†èƒ½å¤Ÿç†è§£ Docker åŸç†ï¼Œå†³å®šè‡ªå·±ä»é›¶å¼€å§‹å­¦ä¹  Docker è¿™ä¸ªé£é¡å…¨çƒçš„å®¹å™¨è§£å†³æ–¹æ¡ˆï¼Œå°†å­¦ä¹ çš„è¿‡ç¨‹è®°å½•ä¸‹æ¥ã€‚ å®‰è£…Docker åœ¨ CentOS 6.10 ä¸Šçš„å®‰è£…å…¬å¸çš„ç³»ç»Ÿä½¿ç”¨çš„æ˜¯ CentOS 6ï¼Œæ‰€ä»¥å…ˆå°†å†…æ ¸å‡çº§è‡³ 3.10 ä»¥ä¸Šç‰ˆæœ¬ 123rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.orgyum install https://www.elrepo.org/elrepo-release-6-8.el6.elrepo.noarch.rpmyum --enablerepo=elrepo-kernel install kernel-lt -y ä¹‹åä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å°† Docker æºåŠ å…¥åˆ° yum æºä¸­ 12345678tee /etc/yum.repos.d/docker.repo &lt;&lt;-'EOF'[dockerrepo]name=Docker Repositorybaseurl=https://yum.dockerproject.org/repo/main/centos/$releasever/enabled=1gpgcheck=1gpgkey=https://yum.dockerproject.org/gpgEOF ä¹‹åè¿è¡Œä¸‹é¢çš„å‘½ä»¤å®‰è£…ã€å¯åŠ¨ Docker 123yum install -y docker-engineservice docker start ä¸­é—´é‡åˆ°å¾ˆå¤šé—®é¢˜ï¼Œå¤§æ¦‚åˆ—ä¸¾ä¸€ä¸‹ docker: relocation error: docker: symbol dm_task_get_info_with_deferred_remove, version Base not defined in file libdevmapper.so.1.02 with link time reference è¿™ä¸ªæ˜¯è¯´ device-mapper ç‰ˆæœ¬è¿‡ä½ï¼Œå‡çº§ä¸€ä¸‹ 1yum update device-mapper FATAL: Module bridge not found. å†…æ ¸ç‰ˆæœ¬é—®é¢˜ï¼Œå‡çº§åˆ° 3.10 ä»¥ä¸Šè§£å†³ FATA[0000] Error starting daemon: Error initializing network controller: Error creating default â€œbridgeâ€ network: canâ€™t find an address range for interface â€œdocker0â€ æ­¤é”™è¯¯æ˜¯å› ä¸ºå…¬å¸å†…ç½‘æœ‰ 172.16.0.0/16 çš„è·¯ç”±è¡¨ï¼Œå°† docker0 çš„ç½‘å¡ç½‘æ®µå ç”¨äº†å¯¼è‡´çš„ï¼Œé€šè¿‡åœ¨ /etc/sysconfig/docker ä¸­å¢åŠ ä»¥ä¸‹å‚æ•°ï¼Œå¼ºåˆ¶è®© Docker åˆ›å»ºè™šæ‹Ÿæœºæ—¶ä½¿ç”¨ç‰¹å®šç½‘æ®µæ¥è§£å†³ï¼š 1other_args=&quot;-bip=192.168.100.1/24&quot; æ‹‰å–é•œåƒæç¤º Get https://index.docker.io/v1/repositories/library/hello-world/images: dial tcp 52.207.42.240:443: network is unreachable è¿™ä¸ªè‚¯å®šæ˜¯ç½‘ç»œé—®é¢˜äº†ï¼Œå…¬å¸çš„æ ‡å‡†æœåŠ¡å™¨æ˜¯æ²¡æœ‰åŠæ³•ä¸Šå¤–ç½‘çš„ï¼Œç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­æŒ‡å®šæˆ‘è‡ªå·±çš„ä»£ç†æœåŠ¡å™¨å±…ç„¶ä¹Ÿä¸ç®¡ç”¨ï¼Œå°è¯•äº†å¤šç§æ–¹æ³•ï¼Œç›®å‰é—®é¢˜è¿˜æ²¡è§£å†³ Docker åœ¨ Ubuntu 16.04 ä¸Šçš„å®‰è£…ç”±äº Docker æœ€æ—©å°±æ˜¯åœ¨ Ubuntu ä¸Šå‘å±•å‡ºæ¥çš„ï¼Œè¿™é‡Œä¹Ÿè®°å½•ä¸‹ Ubuntu 16.04 çš„å®‰è£…æ–¹æ³• é¦–å…ˆï¼Œå®‰è£… Docker å®˜æ–¹ä»“åº“çš„ GPG key åˆ°ç³»ç»Ÿä¸­ 1curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add - æ·»åŠ  Docker apt æº 1sudo add-apt-repository &quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable&quot; ç„¶åï¼Œè¿›è¡Œä¸€ä¸‹æ›´æ–° 1sudo apt-get update ç¡®è®¤ Docker repo å¯ä»¥å®‰è£… 1apt-cache policy docker-ce å¦‚æœçœ‹åˆ°ä¸‹é¢çš„å†…å®¹è¯´æ˜æ˜¯ OK çš„ 1234567Output of apt-cache policy docker-cedocker-ce: Installed: (none) Candidate: 18.06.1~ce~3-0~ubuntu Version table: 18.06.1~ce~3-0~ubuntu 500 500 https://download.docker.com/linux/ubuntu xenial/stable amd64 Packages å®‰è£… Docker 1sudo apt-get install -y docker-ce ç¡®è®¤ Docker æ˜¯å¦å·²ç»å®‰è£… 1sudo systemctl status docker ç±»ä¼¼ä¸‹é¢çš„è¾“å‡ºè¯´æ˜æ­£ç¡®å®‰è£…äº† 12345678â— docker.service - Docker Application Container Engine Loaded: loaded (/lib/systemd/system/docker.service; enabled; vendor preset: enabled) Active: active (running) since Thu 2018-10-18 20:28:23 UTC; 35s ago Docs: https://docs.docker.com Main PID: 13412 (dockerd) CGroup: /system.slice/docker.service â”œâ”€13412 /usr/bin/dockerd -H fd:// â””â”€13421 docker-containerd --config /var/run/docker/containerd/containerd.toml å¦å¤–ï¼Œdocker run ä»ç„¶æ˜¯æç¤ºç½‘ç»œé—®é¢˜æ— æ³•è®¿é—®ï¼Œè·Ÿ CentOS ä¸€æ ·æ— è®ºå¦‚ä½•åŠ ä»£ç†éƒ½ä¸è¡Œ 1234# docker run hello-worldUnable to find image 'hello-world:latest' locallydocker: Error response from daemon: Get https://registry-1.docker.io/v2/: net/http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers).See 'docker run --help'. æœ€åï¼Œåªèƒ½è®© Docker Host ç›´æ¥è¿æ¥å¤–ç½‘æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ ä½¿ç”¨æ‰§è¡Œ Docker å‘½ä»¤å¼€å§‹äº†è§£ Docker å‘½ä»¤ï¼Œæœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯æ‰§è¡Œ Hello World äº† 1$ docker run hello-world æˆåŠŸåä¼šçœ‹åˆ°å¦‚ä¸‹çš„è¾“å‡ºï¼š 1234Hello from Docker!This message shows that your installation appears to be working correctly.... è¿è¡Œä¸€ä¸ª Docker å®¹å™¨hello-world è¿™ä¸ªé•œåƒçš„ä½œç”¨æ˜¯è¾“å‡ºä¸€æ®µæ–‡æœ¬ç„¶åé€€å‡ºï¼Œæ¯ä¸€ä¸ª Docker å®¹å™¨å…¶å®éƒ½æ˜¯ä¸€ä¸ªæœ‰ç‰¹å®šåŠŸèƒ½çš„åº”ç”¨ï¼Œæ¯”å¦‚ ubuntu è¿™ä¸ªé•œåƒï¼Œå°±æ˜¯ä¸€ä¸ª Ubuntu è™šæ‹Ÿæœºã€‚ è¯•ç€è¿è¡Œä¸€ä¸ª 123$ docker run -it -d ubuntu# -it å‚æ•°å¯ä»¥è®©æˆ‘ä»¬äº¤äº’å¼çš„ shell è¿›å…¥å®¹å™¨ è¿™ä¸ªæ—¶å€™ä¼šè¾“å‡ºä¸€æ®µå­—ç¬¦ä¸²ï¼Œè¿™æ®µå­—ç¬¦ä¸²å¯ä»¥ç†è§£ä¸º Docker å®¹å™¨ ID 141b162b9dd3f4dc2b7d37bf195a2c4f09d38a05cf750cfbf07e90313da2a3995 è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿›å…¥è¿™ä¸ªå®¹å™¨å†…ï¼Œå»ä¸€çœ‹ç©¶ç«Ÿäº† 12345678$ docker exec -it 41b16 /bin/bashroot@41b162b9dd3f:/# ps -ef UID PID PPID C STIME TTY TIME CMDroot 1 0 0 07:09 pts/0 00:00:00 /bin/bashroot 10 0 0 07:11 pts/1 00:00:00 /bin/bashroot 21 10 0 07:13 pts/1 00:00:00 ps -ef ç®¡ç†ç”¨ä¸€æ®µæ—¶é—´çš„ Docker ä¹‹åï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæœ‰å¾ˆå¤šè¿è¡Œä¸­çš„å’Œéè¿è¡ŒçŠ¶æ€çš„å®¹å™¨ï¼Œæ€ä¹ˆå»ç®¡ç†å®ƒä»¬å‘¢ï¼Ÿ æŸ¥çœ‹ Docker å®¹å™¨docker ps å‘½ä»¤å¯ä»¥è®©æˆ‘ä»¬çœ‹åˆ°ç›®å‰è¿è¡Œä¸­çš„ Docker å®¹å™¨æƒ…å†µ 1$ docker ps è¾“å‡ºå¦‚ä¸‹ï¼š 123456CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES41b162b9dd3f ubuntu &quot;/bin/bash&quot; 5 minutes ago Up 5 minutes zealous_murdock47651cfa1d8e golang &quot;bash&quot; 14 hours ago Up 14 hours optimistic_lederberg3b80522e5902 busybox &quot;sh&quot; 37 hours ago Up 37 hours zealous_darwin8b881720ceb8 redis &quot;docker-entrypoint.sâ€¦&quot; 37 hours ago Up 37 hours 0.0.0.0:6379-&gt;6379/tcp musing_noycef3f14f20b61f nginx &quot;nginx -g 'daemon ofâ€¦&quot; 37 hours ago Up 37 hours 80/tcp zealous_blackburn å¥‡æ€ªï¼Œæˆ‘ä»¬åˆšæ‰è¿è¡Œçš„ Hello World æ²¡æœ‰åœ¨åˆ—è¡¨é‡Œï¼Œä»€ä¹ˆåŸå› å‘¢ï¼Ÿ å…¶å® Hello World å±äºéæ´»åŠ¨çŠ¶æ€çš„é•œåƒï¼Œåªè¦ç»™ docker ps å‘½ä»¤åŠ ä¸Š -a å‚æ•°å°±å¯ä»¥çœ‹åˆ°äº† 12345678910111213141516$ docker ps -aCONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES41b162b9dd3f ubuntu &quot;/bin/bash&quot; 6 minutes ago Up 6 minutes zealous_murdock258796d0e4ed hello-world &quot;/hello&quot; 12 minutes ago Exited (0) 12 minutes ago trusting_swartz47651cfa1d8e golang &quot;bash&quot; 14 hours ago Up 14 hours optimistic_lederberg3b80522e5902 busybox &quot;sh&quot; 37 hours ago Up 37 hours zealous_darwin8b881720ceb8 redis &quot;docker-entrypoint.sâ€¦&quot; 37 hours ago Up 37 hours 0.0.0.0:6379-&gt;6379/tcp musing_noyce0a02170a956f hello-world &quot;/hello&quot; 37 hours ago Exited (0) 37 hours ago determined_mestorff3f14f20b61f nginx &quot;nginx -g 'daemon ofâ€¦&quot; 37 hours ago Up 37 hours 80/tcp zealous_blackburnb43d4f2ba5ed ubuntu &quot;/bin/bash&quot; 37 hours ago Exited (0) 7 minutes ago unruffled_snyder66aa497d9767 ubuntu &quot;/bin/bash&quot; 37 hours ago Exited (0) 37 hours ago hungry_boyd126e0f019b19 ubuntu &quot;/bin/bash&quot; 37 hours ago Exited (0) 37 hours ago competent_goldwasser600adf161623 ubuntu &quot;/bin/bash&quot; 37 hours ago Exited (0) 37 hours ago upbeat_thompson3b5d4380392f ubuntu &quot;/bin/bash&quot; 37 hours ago Exited (0) 37 hours ago pedantic_euclid4fd577a1e8bf ubuntu &quot;/bin/bash&quot; 37 hours ago Exited (0) 37 hours ago upbeat_mcnulty è€Œå¦‚æœä½¿ç”¨ -l å‚æ•°ï¼Œåˆ™å¯ä»¥çœ‹åˆ°æœ€è¿‘åˆ›å»ºçš„ Docker å®¹å™¨ 1234$ docker ps -lCONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES41b162b9dd3f ubuntu &quot;/bin/bash&quot; 10 minutes ago Up 10 minutes zealous_murdock å…³é—­ä¸€ä¸ª Docker å®¹å™¨æˆ‘ä»¬åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­è¿è¡Œäº†å¾ˆå¤šå®¹å™¨å®ä¾‹äº†ï¼Œä¸€äº›å®¹å™¨ä¸éœ€è¦å†å»ä½¿ç”¨äº†ï¼Œ ä½¿ç”¨ docker stop å‘½ä»¤å¯ä»¥å°†æ´»åŠ¨çŠ¶æ€çš„å®¹å™¨åœæ­¢è¿è¡Œ 1$ docker stop 41b162b9dd3f ä¸ä»…å¯ä»¥ä½¿ç”¨ container ID æŒ‡å®šå®¹å™¨ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å®¹å™¨åˆ«åæ¥æ“ä½œ 123$ docker stop zealous_murdockzealous_murdock åœæ­¢è¿è¡Œçš„å®¹å™¨å°±å¯ä»¥å…³æ‰äº†ï¼Œè¿™é‡Œä½¿ç”¨çš„å‘½ä»¤æ˜¯ docker rm 123# docker rm zealous_murdockzealous_murdock overlay2 ä»£æ›¿ auFS ä½œä¸ºæ–°çš„ Union File System æ¥ä½¿ç”¨","link":"/2019/03/03/docker-learn-memo-1/"},{"title":"ä¸ºnginxé…ç½®httpså¹¶è‡ªç­¾åè¯ä¹¦","text":"ä¸ºäº†ä½¿ç½‘ç«™å¯ä»¥ä½¿ç”¨åŠ å¯†çš„æ–¹å¼è®¿é—®, æˆ‘ä»¬æœ‰æ—¶éœ€è¦é…ç½®https, æ­¤æ–‡ç« ç®€å•ä»‹ç»ä¸€ä¸‹æ–¹æ³•.##æŠŠè¯ä¹¦å‡†å¤‡å¥½ã€‚ ###åˆ¶ä½œCAè¯ä¹¦ï¼š ca.key CAç§é’¥ï¼š openssl genrsa -des3 -out ca.key 2048 åˆ¶ä½œè§£å¯†åçš„CAç§é’¥ï¼ˆä¸€èˆ¬æ— æ­¤å¿…è¦ï¼‰ï¼š openssl rsa -in ca.key -out ca_decrypted.key ca.crt CAæ ¹è¯ä¹¦ï¼ˆå…¬é’¥ï¼‰ï¼š openssl req -new -x509 -days 7305 -key ca.key -out ca.crt ###åˆ¶ä½œç”Ÿæˆç½‘ç«™çš„è¯ä¹¦å¹¶ç”¨CAç­¾åè®¤è¯åœ¨è¿™é‡Œï¼Œå‡è®¾ç½‘ç«™åŸŸåä¸ºblog.archean.me ç”Ÿæˆblog.archean.meè¯ä¹¦ç§é’¥ï¼š openssl genrsa -des3 -out blog.archean.me.pem 1024 åˆ¶ä½œè§£å¯†åçš„blog.archean.meè¯ä¹¦ç§é’¥ï¼š openssl rsa -in blog.archean.me.pem -out blog.archean.me.key ç”Ÿæˆç­¾åè¯·æ±‚ï¼š openssl req -new -key blog.archean.me.pem -out blog.archean.me.csr åœ¨common nameä¸­å¡«å…¥ç½‘ç«™åŸŸåï¼Œå¦‚blog.archean.meå³å¯ç”Ÿæˆæ”¹ç«™ç‚¹çš„è¯ä¹¦ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ä½¿ç”¨æ³›åŸŸåå¦‚*.archean.meæ¥ç”Ÿæˆæ‰€æœ‰äºŒçº§åŸŸåå¯ç”¨çš„ç½‘ç«™è¯ä¹¦ã€‚ ç”¨CAè¿›è¡Œç­¾åï¼š openssl ca -policy policy_anything -days 1460 -cert ca.crt -keyfile ca.key -in blog.archean.me.csr -out blog.archean.me.crt å…¶ä¸­ï¼Œpolicyå‚æ•°å…è®¸ç­¾åçš„CAå’Œç½‘ç«™è¯ä¹¦å¯ä»¥æœ‰ä¸åŒçš„å›½å®¶ã€åœ°åç­‰ä¿¡æ¯ï¼Œdayså‚æ•°åˆ™æ˜¯ç­¾åæ—¶é™ã€‚å¦‚æœåœ¨æ‰§è¡Œç­¾åå‘½ä»¤æ—¶ï¼Œå‡ºç°I am unable to access the ../../CA/newcerts directory ä¿®æ”¹/etc/pki/tls/openssl.cnfä¸­â€œdir = ./CAâ€ ç„¶åï¼š mkdir -p CA/newcerts touch CA/index.txt touch CA/serial echo â€œ01â€³ &gt; CA/serial å†é‡æ–°æ‰§è¡Œç­¾åå‘½ä»¤ã€‚ æœ€åï¼ŒæŠŠca.crtçš„å†…å®¹ç²˜è´´åˆ°blog.archean.me.crtåé¢ã€‚è¿™ä¸ªæ¯”è¾ƒé‡è¦ï¼å› ä¸ºä¸è¿™æ ·åšï¼Œå¯èƒ½ä¼šæœ‰æŸäº›æµè§ˆå™¨ä¸æ”¯æŒã€‚å¥½äº†ï¼Œç°åœ¨httpséœ€è¦åˆ°çš„ç½‘ç«™ç§é’¥blog.archean.me.keyå’Œç½‘ç«™è¯ä¹¦blog.archean.me.crtéƒ½å‡†å¤‡å®Œæ¯•ã€‚æ¥ä¸‹æ¥å¼€å§‹é…ç½®æœåŠ¡ç«¯ã€‚ ##é…ç½®nginxæ–°å¼€ä¸€ä¸ªè™šæ‹Ÿä¸»æœºï¼Œå¹¶åœ¨server{}æ®µä¸­è®¾ç½®ï¼š listen 443; ssl on; ssl_certificate /path/to/blog.archean.me.crt; ssl_certificate_key /path/to/blog.archean.me.key; å…¶ä¸­çš„è·¯å¾„æ˜¯åˆšåˆšç”Ÿæˆçš„ç½‘ç«™è¯ä¹¦çš„è·¯å¾„ã€‚ ç„¶åä½¿ç”¨ä¸€ä¸‹å‘½ä»¤æ£€æµ‹é…ç½®å’Œé‡æ–°åŠ è½½nginxï¼š æ£€æµ‹é…ç½®ï¼š nginx -t é‡æ–°åŠ è½½ï¼š nginx -s reload åœ¨è¿™é‡Œæ˜¯nginxå®˜æ–¹çš„å…³äºhttpsçš„æ–‡æ¡£ï¼Œå¯ä»¥ä½œä¸ºå‚è€ƒã€‚","link":"/2013/10/16/enable-nginx-ssl/"},{"title":"ç”¨ Dropbox public folder åšåšå®¢çš„è¶…ç¨³å®šå›¾åºŠ","text":"ç”±äº Dropbox ä¿®æ”¹äº† Public Folder çš„åŠŸèƒ½ï¼Œæ–¹æ³•å·²å¤±æ•ˆã€‚ è¿™ä¸ªBlogæ˜¯æ­å»ºåœ¨Digital Oceanä¸Šçš„, è¿™ä¸ªVPSè¿˜æ˜¯å¾ˆä¸é”™çš„, åŠ å·çš„èŠ‚ç‚¹åœ¨å¤©æœè®¿é—®é€Ÿåº¦éå¸¸å¯ä»¥, æ‹¥æœ‰20G SSDç£ç›˜å’Œæ¯æœˆ1Tçš„æµé‡, åªéœ€5$, è¿˜æ˜¯éå¸¸è¶…å€¼çš„. ä½†æ˜¯å³ä¾¿å¦‚æ­¤, Blogéœ€è¦çš„å¤§é‡å›¾ç‰‡ç­‰å…ƒç´ è¿˜æ˜¯éå¸¸å ç”¨ç©ºé—´çš„, æ‰€ä»¥åªå¥½æƒ³åŠæ³•å¯»æ‰¾ä¸€ä¸ªç¨³å®šçš„å›¾åºŠæ¥å­˜. æˆ‘ä¸€ç›´æ˜¯Dropboxçš„é‡åº¦ç”¨æˆ·, è‡ªç„¶æƒ³åˆ°å¥¹çš„Public Folder. Dropbox Publicç›®å½•æ¯æ—¥é™åˆ¶æµé‡ 20G, æ¥æº Dropbox Public Folderçš„åœ°å€æ˜¯https://dl.dropboxusercontent/u/idxxxxxxxx/, Blogå¼•ç”¨èµ·æ¥ä¸å¤Ÿä¼˜é›…, äºæ˜¯èŒç”Ÿäº†æ­¤æ–‡. é…ç½®èµ·æ¥éå¸¸ç®€å•, ç»è¿‡æˆ‘çš„åå¤å®è·µ, Nginx vhostæœ€å°é…ç½®ä¸º: server { listen 80; server_name img.archean.me; root /path/to/www/root; #ä¹Ÿå¯çœç•¥ location / { rewrite /(.*) /u/DropboxID/img/$1 break; proxy_pass https://dl.dropboxusercontent.com/; } } æ­¤é…ç½®è¶³ä»¥ä½¿ç”¨, æœ€ç»ˆæ•ˆæœæ˜¯å½“æˆ‘è®¿é—®http://img.archean.me/1.jpgæ—¶, å¯ä»¥æ˜¾ç¤ºhttps://dl.dropboxusercontent.com/u/19060928/img/1.jpgçš„å›¾ç‰‡","link":"/2013/10/21/make-dropbox-public-folder-a-stable-pic-server/"},{"title":"ä½¿ç”¨ Zabbix ç›‘æ§ Exchange Server çš„æ•°æ®åº“","text":"åœ¨è¿™ç¯‡æ–‡ç« é‡Œæˆ‘æƒ³è¦åˆ†äº«ä¸€ä¸‹ Exchange Server 2016 æ•°æ®åº“çŠ¶æ€ä»¥åŠæ•°æ®åº“ä½¿ç”¨é‡çš„ç›‘æ§æ–¹æ³•ï¼Œç»è¿‡å‡ æ¬¡ä¿®æ”¹å’Œè¿­ä»£ï¼Œç›®å‰æˆ‘ä½¿ç”¨çš„æ˜¯ Zabbix 3.2 å¯¹æ•°æ®åº“è¿›è¡Œç»Ÿä¸€ã€è‡ªåŠ¨åŒ–ã€åŠ¨æ€è‡ªé…ç½®çš„ç›‘æ§ã€‚ ä¸»è¦è§£å†³äº†å“ªäº›é—®é¢˜ï¼Ÿå½“å‰ä¸»æµçš„ç›‘æ§å¹³å°ï¼Œå¦‚ Zabbixã€Prometheusï¼Œå¾®è½¯è‡ªå®¶çš„ SCOMï¼Œè¿˜æœ‰å¤è‘£ Cacti æˆ‘éƒ½å·²ç»è¿›è¡Œè¿‡æˆ–å¤šæˆ–å°‘çš„å°è¯•ï¼Œæœ€ç»ˆé€‰å®š Zabbix ä½œä¸º Exchange Server çš„ç»Ÿä¸€ç›‘æ§å¹³å°ï¼Œä¸»è¦åŸå› æ˜¯å®ƒé«˜è‡ªç”±åº¦çš„é…ç½®ã€åˆ†å¸ƒå¼éƒ¨ç½²æ–¹å¼ä»¥åŠä¸°å¯Œçš„ API æ¥å£ï¼Œä¾¿äºé’ˆå¯¹æ€§çš„ä¿®æ”¹å’Œè·å–æ•°æ®ç”¨äºç»Ÿä¸€å±•ç¤ºï¼Œå›¾è¡¨åŠŸèƒ½ä¸€èˆ¬ä½†æ˜¯å¤Ÿç”¨ï¼Œå¥½åœ¨å¯ä»¥é€šè¿‡ API å°†æ•°æ®å–å‡ºæ¥åšäºŒæ¬¡å¤„ç†ã€‚ åœ¨èŠ±è´¹äº†å¤§é‡æ—¶é—´ä¼˜åŒ–è°ƒæ•´ç›‘æ§é¡¹ã€è§¦å‘å™¨ä»¥åŠå‘Šè­¦ç­–ç•¥ä¹‹åï¼Œåªå‰©æœ€åä¸€å—éš¾å•ƒçš„çŸ³å¤´ï¼Œä¹Ÿå°±æ˜¯ä»Šå¤©è®¨è®ºçš„æ•°æ®åº“çŠ¶æ€ç›‘æ§ã€‚ Exchange æ•°æ®åº“ç›‘æ§çš„æ¼”å˜é›†å›¢ Exchange æ•°æ®åº“çš„ç›‘æ§ç»å†äº† 3 ä¸ªä¸»è¦é˜¶æ®µï¼š æœ€åˆæ˜¯æ ¹æ®ä¸€ä¸ªæ•°æ®åº“åˆ—è¡¨æ–‡æ¡£è·‘è„šæœ¬ï¼Œé€šè¿‡ Test-MAPIConnectivity æ£€æµ‹æ•°æ®åº“æ˜¯å¦æŒ‚è½½ï¼Œå‘é€çŸ­ä¿¡æ¥å‘Šè­¦ã€‚æ‰‹å·¥ç»´æŠ¤éš¾å…é€ æˆé—æ¼ï¼› åœ¨ç»å†äº†ä¸€ä¸ªç”±äºä¸»å¤‡å…³ç³»é—®é¢˜å¯¼è‡´çš„é›†ç¾¤å´©æºƒäº‹æ•…ä¹‹åï¼Œç¬¬äºŒé˜¶æ®µçš„è„šæœ¬ä½¿ç”¨ Get-MailboxDatabaseCopyStatus æ¥ä¾¦æµ‹æ•°æ®åº“çŠ¶æ€ã€‚å¦å¤–å¯ä»¥è‡ªåŠ¨çš„æ£€æµ‹æ–°åŠ å…¥çš„æ•°æ®åº“ï¼› ä½†æ˜¯æ•°æ®åº“å¤§å°ã€äººæ•°ã€å¯ç”¨ç©ºé—´ã€ä¸»å¤‡å…³ç³»è¿™äº›ä¸œè¥¿æ²¡æœ‰ç›´è§‚çš„å±•ç¤ºå‡ºæ¥ï¼Œäºæ˜¯è¿›åŒ–åˆ°ç¬¬ä¸‰é˜¶æ®µï¼ŒZabbix ç»Ÿä¸€ç›‘æ§å±•ç¤ºã€‚ Zabbix ç›‘æ§æ•°æ®åº“æ€è·¯ç›®å‰æ‰€æœ‰çš„é‚®ä»¶æœåŠ¡å™¨å‡å·²åŠ å…¥ Zabbix åšåŸºç¡€çš„ç¡¬ä»¶ä¿¡æ¯å’ŒæœåŠ¡ã€æ€§èƒ½æŒ‡æ ‡çš„ç›‘æ§ã€‚ ä½¿ç”¨ Zabbix å‘ç°æœåŠ¡ï¼Œé€šè¿‡ä¸€ä¸ª Powershell è„šæœ¬( Get-ExchangeDBDiscovery.ps1 )è·å–åˆ°æ¯å°æœåŠ¡å™¨ä¸­çš„æ•°æ®åº“ä¿¡æ¯ï¼Œå†™å…¥åˆ°æœåŠ¡å™¨ç›‘æ§é¡¹ä¸­ï¼›ä¸ºäº†å‡å°‘æŠ“å–å»¶è¿Ÿï¼ŒæœåŠ¡å™¨æœ¬åœ°æ¯åˆ†é’Ÿä¼šæ‰§è¡Œå¦ä¸€ä¸ª Powershell è„šæœ¬(Get-ExchangeDBStatus.ps1)ï¼Œå°†æ‰€éœ€è¦çš„æ•°æ®åº“ä¿¡æ¯å…¨éƒ¨å†™å…¥åˆ°è„šæœ¬æ‰§è¡Œç›®å½•ä¸­çš„å­ç›®å½• DBStatus ä¸­ï¼›Zabbix ä¸­çš„æœåŠ¡å™¨ï¼Œé€šè¿‡æ‰§è¡Œè‡ªå®šä¹‰å‘½ä»¤ä» CSV æ–‡ä»¶ä¸­è·å–å­—æ®µå€¼ï¼Œå®Œæˆæ•°æ®æ”¶é›†ï¼›å¦‚æœæ•°æ®åº“è¢«å¸è½½ï¼Œåˆ™è§¦å‘ä¸€çº§å‘Šè­¦ï¼Œç›´æ¥ç”µè¯é€šçŸ¥æˆ‘ã€‚è‹¥æ•°æ®åº“åŒæ­¥çŠ¶æ€å¼‚å¸¸ï¼Œåˆ™è§¦å‘äºŒçº§å‘Šè­¦ï¼Œä½¿ç”¨é›†å›¢å†…éƒ¨ IM è½¯ä»¶å‘Šè¯‰æˆ‘ã€‚ å›°éš¾ç”±äºæˆ‘çš„ç›®æ ‡æ˜¯åšæˆå…¨è‡ªåŠ¨ç›‘æ§ï¼Œè€Œä¸”æ•°æ®åº“æ•°é‡å®åœ¨å¤ªå¤šï¼ˆé›†å›¢æ¥è¿‘ 50000 äººï¼Œåˆ†äº† 300 å¤šä¸ªæ•°æ®åº“ï¼‰æ‰€ä»¥å…¶ä¸­æ¯”è¾ƒå›°éš¾çš„ç‚¹åœ¨äºï¼š ç”±äºæ•°æ®åº“åˆ† Active å’Œ Passiveï¼Œä¼šåœ¨ä¸¤å°æˆå¯¹çš„æœåŠ¡å™¨ä¸­å„ç”Ÿæˆä¸€ä¸ªç›‘æ§é¡¹ï¼Œé™ä½ Zabbix æ‰§è¡Œæ•ˆç‡ï¼Œæ‰€ä»¥å¿…é¡»åˆ†å¼€ ç”±äº Active å’Œ Passive ä¼šåˆ‡æ¢ï¼Œå¦‚æœç›‘æ§é¡¹ä¹Ÿè·Ÿç€åˆ‡æ¢ï¼Œä¼šé€ æˆä¸´æ—¶æ€§æ•°æ®è·å–å¤±è´¥ ä¸»å¤‡å…³ç³»åˆ‡æ¢åŒæ ·ä¼šå¯¼è‡´æŒ‚è½½ä¿¡æ¯å’Œå¤åˆ¶ä¿¡æ¯çš„æ··ä¹± è§£å†³æ–¹æ¡ˆå¯¹äºç¬¬ä¸€ç‚¹å’Œç¬¬äºŒç‚¹ï¼Œé€šè¿‡ Get-MailboxDatabaseCopyStatus ä¸­æ•°æ®åº“æŒ‚è½½ä¼˜å…ˆçº§å­—æ®µ ActivationPreference å°†ä¸»å¤‡å…³ç³»å›ºå®šï¼Œå»æ‰ä¼˜å…ˆçº§æ˜¯ 2 çš„æ•°æ®åº“ã€‚ å¯¹äºç¬¬ä¸‰ç‚¹ï¼Œä½¿ç”¨äº†ä¸€ä¸ªè¿‡æ»¤æ–¹æ³• Get-MailboxDatabaseCopyStatus | Where {$_.status -like &quot;*ount*&quot;} ,ount æ˜¯ Active çš„æ•°æ®åº“å¯èƒ½çš„å››ç§çŠ¶æ€ï¼šMountedã€Dismountedã€Mountingã€Dismountingã€‚ æºç ä½¿ç”¨æ–¹æ³•æºç æˆ‘å·²ç»æ”¾åœ¨äº† GitHubï¼Œä½¿ç”¨æ–¹æ³•ï¼š å°† Get-ExchangeDBStatus.ps1 åŠ å…¥è®¡åˆ’ä»»åŠ¡ï¼Œæ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ ä¿®æ”¹ Exchange æœåŠ¡å™¨çš„ Zabbix Agent æœåŠ¡é…ç½®ï¼Œå¯ä»¥å‚è€ƒ zabbix_agentd.conf Zabbix ä¸­å¯¼å…¥æ¨¡ç‰ˆ ZabbixTemplate_Exchange Server 2016 Database Monitor.xml å°†æºç ä¸­çš„å¦å¤–ä¸¤ä¸ªè„šæœ¬ Get-ExchangeDBDiscovery.ps1ã€Get-ExchangeDB.ps1 æ”¾åˆ°ä¸ zabbix_agentd.conf åŒçº§æˆ–è‡ªå®šä¹‰ç›®å½•ä¸­ï¼ˆæ”¾ç½®åœ¨è‡ªå®šä¹‰ç›®å½•éœ€è¦ä¿®æ”¹ zabbix_agentd.conf ä¸­çš„è„šæœ¬è·¯å¾„ï¼‰ å¦‚æœæ˜¯è¾ƒå¤§å‹çš„ä¼ä¸šæˆ–æ•°æ®åº“æœåŠ¡å™¨è¾ƒå¤šï¼Œæ¨èå°†ä¸‰ä¸ª powershell è„šæœ¬ç½®äº UNC è·¯å¾„ä¸­ï¼ŒZabbix æ˜¯æ”¯æŒçš„ï¼Œè¿™æ ·ä¾¿äºéƒ¨ç½²é…ç½®ã€‚ åè®°å…¶å®åœ¨æ—©æœŸæ›¾ç»å°è¯•è¿‡åœ¨ä¸€å°æœºå™¨ä¸Šè¿›è¡Œæ‰€æœ‰æ•°æ®åº“çš„æ”¶é›†ï¼Œè¿™æ ·ä¼šè®©æ•´ä¸ªæ–¹æ¡ˆå»ºç«‹èµ·æ¥å¿«é€Ÿå’Œæ–¹ä¾¿å¾—å¤šï¼Œåªéœ€è¦æ‰§è¡Œä¸€æ¬¡è„šæœ¬ï¼Œä¹Ÿä¸éœ€è¦é‚£ä¹ˆå¤šçš„åˆ¤æ–­ã€‚ä½†æ˜¯å¯¹äº 50 ä¸ªä»¥ä¸Šæ•°æ®åº“è§„æ¨¡çš„æ¶æ„ï¼Œè¿™ä¸ªæ–¹æ³•ä¸é€‚ç”¨äº†ï¼Œä¸€æ–¹é¢è„šæœ¬æ‰§è¡Œæ•ˆç‡å ªå¿§ï¼Œå®Œæ•´æ‰§è¡Œä¸€æ¬¡å¯èƒ½è¦ 5 åˆ†é’Ÿä»¥ä¸Šï¼Œè¿™å¯¹äºæˆ‘ä»¬ 99.995% çš„ SLA è¦æ±‚æ˜¾ç„¶æ˜¯ä¸èƒ½å¤Ÿæ»¡è¶³éœ€æ±‚çš„ï¼›å…¶æ¬¡ Zabbix å¯¹äºå•ä¸ªä¸»æœºçš„ç›‘æ§é¡¹æ”¶é›†æ•ˆç‡ä¹Ÿä¸å¤Ÿï¼Œå®æµ‹èµ·æ¥å¯èƒ½ä¼šäº§ç”Ÿæœ€å¤š 15 åˆ†é’Ÿçš„å»¶è¿Ÿå‘Šè­¦ï¼Œè¿™æ ·æ˜¯æ— æ³•æ¥å—çš„ã€‚ å¦‚æœæ˜¯å°å‹å…¬å¸ï¼Œæ•°æ®åº“æ•°é‡ä½¿ç”¨å•ä¸€è„šæœ¬åšå…¨éƒ¨æ•°æ®åº“æ”¶é›†æ˜¾ç„¶æ˜¯æ²¡é—®é¢˜çš„","link":"/2019/03/17/moniting-exchange-server-with-zabbix/"},{"title":"ä½¿ç”¨Squidä¸Stunnelæ„å»ºå®‰å…¨çš„httpä»£ç†æœåŠ¡å™¨","text":"ä½¿ç”¨Squidåœ¨æœåŠ¡å™¨ç«¯æ‰“å¼€ä¸€ä¸ªhttp éªŒè¯çš„ä»£ç†ç«¯å£, åŒæ—¶ç”¨æœåŠ¡å™¨ä¸Šçš„Stunnelè¿›è¡Œè½¬å‘, ä¸å®¢æˆ·ç«¯çš„Stunnelé€šè¿‡SSLé“¾æ¥, è¾¾åˆ°ä»£ç†çš„ç›®çš„. ä¹Ÿå¯ä»¥ä½¿ç”¨å®¢æˆ·ç«¯çš„Stunnelä¸Squidé€šè¿‡SSLç›´æ¥ç›¸è¿. æœ¬æ–¹æ³•ä½¿ç”¨å‰è€…. 1. æœåŠ¡å™¨ç«¯é…ç½®æœåŠ¡å™¨ç¯å¢ƒ: 12345678# lsb_release -aLSB Version: :core-4.0-ia32:core-4.0-noarch:graphics-4.0-ia32:graphics-4.0-noarch:printing-4.0- ia32:printing-4.0-noarchDistributor ID: CentOSDescription: CentOS Linux release 6.0 (Final)Release: 6.0Codename: Final # uname -aLinux jb1.archean.me 2.6.32-71.el6.i686 #1 SMP Fri Nov 12 04:17:17 GMT 2010 i686 i686 i386 GNU/Linux 1.1 å®‰è£…Squidä¸‹è½½squid 3.2.8 1# wget http://www.squid-cache.org/Versions/v3/3.2/squid-3.2.8.tar.gz å¯ä»¥ä½¿ç”¨CentOSçš„Yumå®‰è£…å·¥å…·, ä¸è¿‡æˆ‘æ›´å–œæ¬¢ç¼–è¯‘å®‰è£…(æå‰å‡†å¤‡å¥½ç¼–è¯‘ç¯å¢ƒ, Gcc, opensslç­‰): 12345# tar zxvf squid-3.2.8.tar.gz# cd squid-3.2.8# ./configure --prefix=/usr/local --enable-basic-auth-helpers=NCSA# make# make install 1.2 é…ç½®Squidè¿™ä¸ªæ‹“æ‰‘ç»“æ„åªéœ€è¦Squidåšç®€å•çš„httpä»£ç†, æ‰€ä»¥æ— éœ€SSL. squidçš„é…ç½®æ–‡ä»¶åœ¨/usr/local/etc/squid.conf å¤‡ä»½ä¹‹å, å°†å…¶æŒ‰ä¸‹é¢ä¿®æ”¹, ä¸ºé˜²æ­¢è¢«åˆ«çš„æœºå™¨æ»¥ç”¨, åªç›‘å¬127.0.0.1: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748###/usr/local/etc/squid.conf###2013-1-27 19:56 v0.0.1 for squid 3.2.6#Xu Zhang &lt;zephyr422@gmail.com&gt;visible_hostname Archean.mecache_mgr zephyr422@gmail.comhttp_port 127.0.0.1:3177icp_port 0cache_mem 256 MBdns_nameservers 8.8.8.8 8.8.4.4coredump_dir /usr/local/var/cache/squidaccess_log /usr/local/var/logs/squid_access.logcache_log /usr/local/var/logs/squid_cache.logauth_param basic program /usr/local/libexec/basic_ncsa_auth /usr/local/etc/squid.passwd #ä½¿ç”¨ HTTP åŸºæœ¬éªŒè¯auth_param basic children 5auth_param basic realm Archean's GFW Breaker Proxy, to forward, please input &quot;Username/Password&quot;.auth_param basic credentialsttl 7 daysauth_param basic casesensitive offacl password proxy_auth REQUIREDacl localnet src 10.0.0.0/8 # RFC1918 possible internal networkacl localnet src 172.16.0.0/12 # RFC1918 possible internal networkacl localnet src 192.168.0.0/16 # RFC1918 possible internal networkacl localnet src fc00::/7 # RFC 4193 local private network rangeacl localnet src fe80::/10 # RFC 4291 link-local (directly plugged) machinesacl SSL_ports port 443acl Safe_ports port 80 # httpacl Safe_ports port 21 # ftpacl Safe_ports port 443 # httpsacl Safe_ports port 70 # gopheracl Safe_ports port 210 # waisacl Safe_ports port 1025-65535 # unregistered portsacl Safe_ports port 280 # http-mgmtacl Safe_ports port 488 # gss-httpacl Safe_ports port 591 # filemakeracl Safe_ports port 777 # multiling httpacl CONNECT method CONNECThttp_access allow passwordhttp_access deny !Safe_portshttp_access deny CONNECT !SSL_portshttp_access allow localnethttp_access allow localhosthttp_access deny all æ£€æŸ¥é…ç½®æœ‰æ²¡æœ‰é—®é¢˜: 1# squid -k check æˆ–è€… 1# squid -k parse ç”Ÿæˆå¯†ç æ–‡ä»¶(-c), åˆ›å»ºè´¦æˆ·. (å¦‚æœæ²¡æœ‰htpasswdéœ€è¦å®‰è£… httpd, ç•¥) 123# htpasswd -c /usr/local/etc/squid.passwd archeannew password... åˆå§‹åŒ–cacheç›®å½• 1# squid -z ä¸€æ—¦ä½ å·²ç»åˆå§‹åŒ–cacheç›®å½•ï¼Œå°±å¯ä»¥åœ¨ç»ˆç«¯çª—å£é‡Œè¿è¡Œsquidï¼Œå°†æ—¥å¿—è®°å½•åˆ°æ ‡å‡†é”™è¯¯ã€‚è¿™æ ·ï¼Œå°±èƒ½è½»æ˜“çš„å®šä½ä»»ä½•é”™è¯¯æˆ–é—®é¢˜ï¼Œå¹¶ä¸”ç¡®è®¤squidæ˜¯å¦æˆåŠŸå¯åŠ¨ã€‚ä½¿ç”¨-Né€‰é¡¹æ¥ä¿æŒsquidåœ¨å‰å°è¿è¡Œï¼Œ-d1é€‰é¡¹åœ¨æ ‡å‡†é”™è¯¯é‡Œæ˜¾ç¤º1çº§åˆ«çš„è°ƒè¯•ä¿¡æ¯ã€‚ 1# squid -N -d1 å¯åŠ¨squid: 1# squid æ£€æŸ¥æ˜¯å¦å¯åŠ¨æˆåŠŸ, ps -ef | grep squid æˆ– lsof -i:3177 æ¨¡æ‹Ÿæµ‹è¯•å®¢æˆ·ç«¯è¿æ¥: 1# squidclient -p 3177 http://www.squid-cache.org/ å¦‚æœŸè¿”å›äº†htmlä¿¡æ¯, è¯´æ˜Squidå·²æˆåŠŸå¯åŠ¨. 1.3 å®‰è£…Stunnelä¸‹è½½ç¨³å®šç‰ˆStunnel 1# wget https://www.stunnel.org/downloads/stunnel-4.56.tar.gz åˆ›å»ºStunnelç”¨æˆ·: 12# /usr/sbin/groupadd -g 122 stunnel# /usr/sbin/useradd -c stunnel -d /nonexistent -m -g 122 -u 122 stunnel å®‰è£…: 12345# tar zxvf stunnel-4.56.tar.gz# cd stunnel-4.56# ./configure --prefix=/usr/local# make# makeinstall å®‰è£…è¿‡ç¨‹é€šå¸¸ä¼šåˆ›å»ºè‡ªç­¾åè¯ä¹¦, ä¼šæ”¾åˆ°/usr/local/etc/stunnel/stunnel.pemå¯ä»¥ç›´æ¥ä½¿ç”¨(æœ‰æ•ˆæœŸä¸€å¹´). ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ£€æŸ¥è¯ä¹¦è¯¦ç»†å†…å®¹: 12345678# openssl x509 -subject -dates -fingerprint -in stunnel.pem subject= /C=CN/ST=Beijing/L=Beijing/O=Archean Inc/OU=Archean Inc/CN=archean.menotBefore=Apr 20 02:05:24 2013 GMTnotAfter=Apr 20 02:05:24 2014 GMTSHA1 Fingerprint=87:F8:6E:05:B8:9C:BC:A1:EA:15:B7:C9:B4:B2:75:FF:8A:CA:C5:FA-----BEGIN CERTIFICATE-----xxx-----END CERTIFICATE----- ç»™è¯ä¹¦ç”Ÿæˆ Diffie-Hellman éƒ¨åˆ† 1# openssl gendh 512&gt;&gt; stunnel.pem è¿™åœ¨4.xç‰ˆæœ¬çš„stunnelä¸Šå¥½åƒæ˜¯å¿…é¡»çš„. å¦‚æœæƒ³è¦è‡ªå·±ç”Ÿæˆè¯ä¹¦, å‘½ä»¤å¦‚ä¸‹: 1# openssl req -new -x509 -days 365 -nodes -config openssl.cnf -out stunnel.pem -keyout stunnel.pem 1.4 é…ç½®Stunnelåœ¨/usr/local/etc/stunnel/ä¸‹åˆ›å»ºstunnel.conf, å†™å…¥å¦‚ä¸‹é…ç½®: 1234567891011121314151617181920212223242526272829303132cert = /usr/local/etc/stunnel/stunnel.pemCAfile = /usr/local/etc/stunnel/stunnel.pemsocket = l:TCP_NODELAY=1socket = r:TCP_NODELAY=1;;;chroot = /var/run/stunnelpid = /tmp/stunnel.pidverify = 3;;; CApath = certs;;; CRLpath = crls;;; CRLfile = crls.pemsetuid = stunnelsetgid = stunnel;;; client=yescompression = zlib;;; taskbar = nodelay = no;;; failover = rr;;; failover = priosslVersion = TLSv1fips=nodebug = 7syslog = nooutput = stunnel.log[sproxy]accept = 34567connect = 127.0.0.1:3177 æ­¤æ—¶ä¾¿å¯å¯åŠ¨stunnel: 1# stunnel æ£€æŸ¥æ˜¯å¦è¿è¡Œ: 12# ps -ef | grep stunnel# lsof -i:34567 1.5 å°†Squidå’ŒStunnelåŠ å…¥å¼€æœºå¯åŠ¨é¡¹ç•¥ 2. å®¢æˆ·ç«¯é…ç½®2.1 linuxå®¢æˆ·ç«¯ä½¿ç”¨stunnelä¸æœåŠ¡å™¨è¿›è¡Œå®‰å…¨è¿æ¥å®‰è£…Stunnel ä¸æœåŠ¡å™¨å®Œå…¨ç›¸åŒ, ç•¥. 2.2 é…ç½®å®¢æˆ·ç«¯Stunnelå°†æœåŠ¡å™¨ç”Ÿæˆçš„è¯ä¹¦ä¼ åˆ°å®¢æˆ·ç«¯ä¸­: 12# cd /usr/local/etc/stunnel# scp root@jb1.archean.me:/usr/local/etc/stunnel/stunnel.pem ./ åˆ›å»ºé…ç½®æ–‡ä»¶ 1# vim stunnel.conf å†…å®¹å¦‚ä¸‹: 12345678910111213141516id = /tmp/stunnel.pidcert = /usr/local/etc/stunnel/stunnel.pemsocket = l:TCP_NODELAY=1socket = r:TCP_NODELAY=1verify = 2CAfile = /usr/local/etc/stunnel/stunnel.pemclient=yescompression = zlibciphers = AES256-SHAdelay = nofailover = priosslVersion = TLSv1fips = no[sproxy]accept = 0.0.0.0:7071connect = jb1.archean.me:34567 å…¶ä¸­acceptæ˜¯æœ¬åœ°ä»£ç†ç›‘å¬åœ°å€, å¦‚ä¸å¯¹å¤–æä¾›æœåŠ¡åˆ™æ”¹ä¸ºaccept = 127.0.0.1:7071 å¯åŠ¨stunnel: 1# /usr/local/bin/stunnel è‡³æ­¤, é…ç½®å®Œå…¨ç»“æŸ, å¯ä»¥é€šè¿‡ä½¿ç”¨Client.IP.Address:7071ä»£ç†ä¸Šç½‘ 2.3 ç»“è¯­å‚è€ƒèµ„æ–™: Squidæƒå¨æŒ‡å—","link":"/2013/10/16/safe-http-proxy-over-squid-and-stunnel/"},{"title":"Secure Proxy Service","text":"0. å…è´£å£°æ˜1æ­¤æœåŠ¡ä»…ç”¨äºç ”ç©¶äº’è”ç½‘æŠ€æœ¯, ä½¿ç”¨è€…è®¿é—®äº†ä»»ä½•ç½‘ç«™æˆ–å‘è¡¨äº†ä»»ä½•è¨€è®º, ä¸ä»£è¡¨æœ¬äººæ”¯æŒå…¶è§‚ç‚¹. 1. æè¿°è¿™æ˜¯ä¸€ä¸ªâ€åŠ å¯†çš„â€ socks ä»£ç†æœåŠ¡, ä½¿ç”¨è€…èƒ½å¤Ÿå®‰å…¨çš„è®¿é—®ä¸–ç•Œä¸Šä»»ä½•ä¸€ä¸ªç½‘ç«™, åœ¨æœ¬åœ°ç½‘ç»œçŠ¶å†µæ­£å¸¸çš„æƒ…å†µä¸‹, å¯ä»¥: æµç•…çš„æ’­æ”¾ YouTube 720P è§†é¢‘, åŸºæœ¬æµç•…çš„æ’­æ”¾ 1080P è§†é¢‘: è®¿é—® Facebook, Twitter, Instagram ç­‰ç½‘ç«™. ä¸ºä¸€äº› app æä¾›è®¿é—®æ”¯æŒ. 2. å¦‚ä½•ä½¿ç”¨æˆ‘ä¼šå°†æœåŠ¡ IP/ç«¯å£(å…¨å±€ä»£ç†æ–¹å¼)å’Œ PAC URL(Proxy Auto Config æ–¹å¼) ä»¥é‚®ä»¶å½¢å¼å‘é€åˆ°ä½ çš„ç§äººé‚®ç®±ä¸­, è·å–åˆ°ä¹‹å, åˆ†åˆ«æŒ‰ç…§å¦‚ä¸‹è¯´æ˜ä½¿ç”¨: å…¨å±€ä»£ç†åœ¨ IE çš„ Lan ä»£ç†è®¾ç½®, Chrome çš„ SwitchyOmega æ’ä»¶, æˆ– mac çš„ç½‘ç»œä»£ç†é…ç½®ä¸­å¡«å†™æœåŠ¡ IP åŠç«¯å£, æ­£ç¡®æ“ä½œå, æ‰€æœ‰ http æœåŠ¡éƒ½å°†èµ°ä»£ç†è®¿é—®, ä¼šå¯¼è‡´éƒ¨åˆ†ç½‘ç«™è®¿é—®é€Ÿåº¦å˜æ…¢. Proxy Auto Config æ–‡ä»¶åœ¨ IE çš„ Lan ä»£ç†è®¾ç½®, Chrome çš„ SwitchyOmega æ’ä»¶, æˆ– mac çš„ç½‘ç»œä»£ç†é…ç½®ä¸­å¡«å†™ pac æ–‡ä»¶ä½ç½®, æ­£ç¡®æ“ä½œå, pac ç™½åå•ä¸­çš„ http æœåŠ¡å°†èµ°ä»£ç†è®¿é—®, æ¨èæ–¹å¼. 3. ç°å­˜é—®é¢˜ç½‘ç»œçŠ¶å†µä¼—æ‰€å‘¨çŸ¥ä¸­å›½å‡ ä¸ªè·¨æ´‹å…‰ç¼†ä¸æ˜¯é‚£ä¹ˆç¨³å®š, ä»£ç†æœåŠ¡æœ‰æ—¶ä¼šå‡ºç°ç½‘ç»œæ³¢åŠ¨åŠä¸å¯ç”¨(éå¸¸å°‘, 4å¹´ä¸­å¤§æ¦‚æ€»è®¡1å¤©)çš„é—®é¢˜, æˆ‘è¿™é‡Œæœ‰å‡ ä¸ªä¸åŒçš„å›½å¤–æœåŠ¡å™¨, åœ¨å‡ºç°å¼‚å¸¸æƒ…å†µæ—¶ä¼šåŠæ—¶åˆ‡æ¢. ç«¯å£è¢«å¤ç”¨æä¾›ç»™ä½ çš„æœåŠ¡ç«¯å£æˆ– PAC æ–‡ä»¶æ˜¯å®Œå…¨å¼€æ”¾çš„, æ„å‘³ç€ä¸€æ—¦æ³„éœ², åˆ«äººå¯ä»¥ç›´æ¥æ‹¿æ¥ç”¨, æ‰€ä»¥å¼ºçƒˆå»ºè®®ä¸è¦ä¸å…¶ä»–äººå…±äº«. å…³äºæ­¤äº‹, æˆ‘æ­£ç ”ç©¶ä¸å½±å“ç”¨æˆ·ä½“éªŒçš„éªŒè¯æ–¹å¼, åç»­å°†ä¼šæ”¹ç‰ˆ. å®‰å…¨é—®é¢˜è™½ç„¶æˆ‘ä¿è¯ä¸ä¼šè¿™ä¹ˆåš, ä¸”ä¹Ÿæ²¡ä»€ä¹ˆå¿…è¦, ä½†æˆ‘æ˜¯æœ‰æŠ€æœ¯æ‰‹æ®µç›‘å¬ä½ æ‰€æœ‰æµé‡çš„, è¯·åœ¨ç¡®ä¿ä¸ä¼šæäº¤éšç§ä¿¡æ¯çš„æƒ…å†µä¸‹ä½¿ç”¨. 4. è´¹ç”¨è´¹ç”¨æ˜¯10å…ƒ/æœˆ, æˆ–100å…ƒ/å¹´, æ¥å— Alipay æˆ– PayPal è½¬è´¦, å¸å·å‡ä¸º zephyr422@gmail.com. å¦‚æœæœåŠ¡ç”±äºä¸å¯æŠ—åŠ›ä¸­æ–­, æˆ‘ä¼šé€€ç»™ä½ å‰©ä½™æ—¶é—´çš„è´¹ç”¨. 5. ä¸€äº›è§£é‡ŠåŠ å¯†çš„: åœ¨å›½å†…-&gt;å›½å¤–è¿™ä¸ªé˜¶æ®µçš„æ‰€æœ‰æµé‡ä¼šç»è¿‡æˆ‘çš„åŠ å¯†, ä¸ä¼šé­é‡æ”¿åºœçš„çªƒå–. è®¿é—®é€Ÿåº¦: ä¸ä½¿ç”¨äººæ•°, æœ¬åœ°ç½‘ç»œçŠ¶å†µåŠå›½é™…çº¿è·¯æœ‰å…³, æˆ‘ä¼šå°½å¯èƒ½ç¡®ä¿ç¨³å®š.","link":"/2014/01/23/secure-proxy-service/"},{"title":"è¯•ä¸€ä¸‹ Hexo æ–°ä¸»é¢˜ï¼šicarus","text":"æœ€è¿‘å°†ä¸»é¢˜ä»ä»åˆ‡æ¢åˆ° icarusï¼Œæ„Ÿè§‰å¾ˆä¸é”™ï¼Œæ–°å»ºä¸€ç¯‡æ–‡ç« è¯•ä¸€ä¸‹ã€‚ ![](https://archean-1256172257.cos.ap-beijing.myqcloud.com/blog/fsnwm.jpg) ![](https://archean-1256172257.cos.ap-beijing.myqcloud.com/blog/xeb0z.jpg) ![](https://archean-1256172257.cos.ap-beijing.myqcloud.com/blog/535pb.jpg) ![](https://archean-1256172257.cos.ap-beijing.myqcloud.com/blog/scpg2.jpg) ![](https://archean-1256172257.cos.ap-beijing.myqcloud.com/blog/p3xdr.jpg) ![](https://archean-1256172257.cos.ap-beijing.myqcloud.com/blog/7opzs.jpg)","link":"/2019/03/02/test-new-theme/"},{"title":"Nginxç¦æ­¢å…¶ä»–åŸŸåè®¿é—®","text":"ä»Šå¤©çœ‹åˆ°ä¸€åˆ™æ¥è‡ª@kyakyçš„è¯„è®º è®©æˆ‘ä¹Ÿæ„è¯†åˆ°äº†è¿™ä¸ªé—®é¢˜: å¦‚æœåˆ«äººæŠŠæˆ‘çš„IPåœ°å€ç»‘åˆ°ä»–çš„åŸŸåä¸Š, é‚£æˆ‘å°±æ˜¯åœ¨ä¸ºåˆ«äººæ­åšå®¢äº†. æˆ‘æœ¬ä»¥ä¸ºNginxé…ç½®ä¸­çš„server_nameé€‰é¡¹å¯ä»¥è¿›è¡Œé˜»æŒ¡, çœ‹æ¥ä¸å®è·µçœŸçš„æ˜¯ä¸èƒ½è½»æ˜“ä¸‹ç»“è®º. ä»Šå¤©å°±å›é¡¾ä¸€ä¸‹è¿™ä¸ªé—®é¢˜çš„æ‰€åœ¨, åŠè§£å†³æ–¹æ¡ˆ. DNSè§£æåœºæ™¯æ˜¯è¿™æ ·: åŸŸå ç±»å‹ IP A.com A a.b.c.d B.com A a.b.c.d ç°åœ¨æˆ‘çš„ç½‘ç«™é…ç½®çš„é»˜è®¤æœåŠ¡æ˜¯A.com.conf: server { listen 80 default; server_name A.com; } å½“åˆæˆ‘ä¸ºäº†é¿å…ç›´æ¥æ‹¿IPè®¿é—®ç«™ç‚¹, åšäº†IPçš„è¿‡æ»¤: if ( $host ~* &quot;\\d+\\.\\d+\\.\\d+\\.\\d+&quot; ) { return 403; } åœ¨è¿™ç§æƒ…å†µä¸‹, è®¿é—®A.comä¼šæ‰¾åˆ°a.b.c.dè¿™ä¸ªIP, Nginxè§£æå¾—çŸ¥åŒ¹é…åˆ°äº†A.com.conf, äºæ˜¯è¿›å…¥document rootç›®å½•è¿›è¡ŒæœåŠ¡. å½“è®¿é—®B.comæ—¶, DNSä¹Ÿä¼šæ‰¾åˆ°a.b.c.dè¿™ä¸ªIP, Nginxè§£æå¾—çŸ¥æ²¡æœ‰åŒ¹é…, äºæ˜¯ä¹Ÿä¼šè¿›å…¥A.com.confçš„document root, ç»§ç»­æä¾›æœåŠ¡ â€“ å› ä¸ºæ˜¯default. å½“æ—¶å¿½ç•¥äº†åŸŸåç»‘å®šIPçš„é—®é¢˜, é‚£ä¹ˆæˆ‘å†åŠ ä¸€æ¡if{}åˆ¤æ–­, ä¸ç¬¦åˆarchean.meçš„éƒ½è¿”å›403, å³å¯è§£å†³è¿™ä¸ªé—®é¢˜äº†. ä½†è¿™æ ·åšæ˜¾ç„¶ä¸å¤Ÿä¼˜é›…, ä¸ä»…é™¡ç„¶å¢åŠ äº†Nginxé…ç½®æ–‡ä»¶çš„å¤æ‚åº¦, åŒæ—¶å¦‚æœæœ‰å¤šä¸ªåŸŸåç»‘å®šè¿™å°æœºå™¨, éœ€è¦ä¿®æ”¹çš„åœ°æ–¹å°±å¤ªå¤šäº†. æ‰€ä»¥æŸ¥é˜…Nginxå®˜æ–¹èµ„æ–™, æœç„¶æœ‰ç›¸åº”çš„è§£å†³åŠæ³• åŸæ¥æˆ‘æ²¡æœ‰åšé»˜è®¤æœåŠ¡default.confçš„é…ç½®, A Default &quot;Catch All&quot; Server Block server { listen 80 default_server; server_name _; # This is just an invalid value which will never trigger on a real hostname. return 403; } å…³é”®åœ¨äºserver_name _;, è¿™æ˜¯æŒ‡æ— æ•ˆåŸŸå, æ— è®ºæ˜¯IPåœ°å€, é”™è¯¯çš„åŸŸåæ‹¼å†™æˆ–æ˜¯æœªåœ¨å…¶ä»–è™šæ‹Ÿä¸»æœºé…ç½®ä¸­æåˆ°çš„åŸŸå, å‡ä¼šè§¦å‘return 403;, æ˜¾ç¤ºé¡µé¢ä¸å­˜åœ¨. äºæ˜¯ç•¥åŠ æ”¹è¿›, å»æ‰å…¶ä»–è™šæ‹Ÿä¸»æœºä¸­çš„defaultå­—æ®µ; æŠŠdefault.confä¸­çš„return 403;æ”¹ä¸ºé‡å®šå‘åˆ°æˆ‘ä»¬æœŸæœ›çš„é»˜è®¤é¦–é¡µ, å³å¯è§£å†³æˆ‘ä»¬çš„é—®é¢˜. server { listen 80 default_server; server_name _; rewrite ^ http://archean.me$request_uri?; }","link":"/2013/10/24/nginx-deny-other-domain-access/"}],"tags":[],"categories":[{"name":"Apple","slug":"Apple","link":"/categories/Apple/"},{"name":"Moniting","slug":"Moniting","link":"/categories/Moniting/"},{"name":"linux","slug":"linux","link":"/categories/linux/"},{"name":"Japan","slug":"Japan","link":"/categories/Japan/"},{"name":"Experience","slug":"Apple/Experience","link":"/categories/Apple/Experience/"},{"name":"Docker","slug":"Docker","link":"/categories/Docker/"},{"name":"F5","slug":"Moniting/F5","link":"/categories/Moniting/F5/"},{"name":"iptables","slug":"linux/iptables","link":"/categories/linux/iptables/"},{"name":"Exchange","slug":"Moniting/Exchange","link":"/categories/Moniting/Exchange/"},{"name":"web","slug":"web","link":"/categories/web/"},{"name":"Web","slug":"Web","link":"/categories/Web/"},{"name":"Life","slug":"Japan/Life","link":"/categories/Japan/Life/"},{"name":"nginx","slug":"nginx","link":"/categories/nginx/"},{"name":"web","slug":"linux/web","link":"/categories/linux/web/"}]}